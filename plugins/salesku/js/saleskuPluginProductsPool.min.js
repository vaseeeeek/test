(function(d){d.saleskuPluginProductsPool={debug:0,debug_messages:{},smart_sku_class_grey:"",smart_sku_class_hide:"",current_change_product:!1,set_products_flag:0,product_id_selector:"#salesku-id-",products:{},product_lists:{},product_list_products:{},binds:{},_off:{},_on:{},init_timeout:0,init_flag:!1,init:function(){1>this.init_timeout&&(this.init_timeout=Math.round((new Date).getTime()/1E3)+1);if(!(this.init_timeout<Math.round((new Date).getTime()/1E3)))if(d(".salesku-id").length>this.count(this.products))setTimeout(function(){d.saleskuPluginProductsPool.init()},
    50);else{for(var a in this.binds){var b=this.binds[a]._function;"function"===typeof b&&b()}this.init_flag=!0}},isInit:function(){return this.init_flag},addList:function(a){var b=this.getListClass(a);""!=b&&this.product_lists.hasOwnProperty(b)||(b="salesku_plugin_product_list-"+Math.random().toString(36).substr(2),a.addClass(b),a.addClass("salesku_plugin_product_list"),this.product_lists[b]=a,this.product_list_products[b]={})},addProduct:function(a,b){if("function"===typeof saleskuPluginProduct){this.products[a]=
    new saleskuPluginProduct(this.product_id_selector+""+a,b);var c=this.products[a].getProductListClass();this.product_list_products.hasOwnProperty(c)||(this.product_list_products[c]={},this.product_lists[c]=this.products[a].getParent());this.product_list_products[c][a]=!0;this.isOff(this.product_lists[c])?this.products[a].init(!1):this.products[a].init(!0)}},isOff:function(a){var b=a.get(0),c;for(c in this._off)if(d(this._off[c]).get(0)==b&&!this._on.hasOwnProperty(c)||0<d(this._off[c]).find(a).length)return!0;
    return!1},setOn:function(a){this._on[a]=a},setOff:function(a){this._off[a]=a},on:function(a){a.length&&a.find(".salesku-id").each(function(){var a=d(this).attr("id").replace(/salesku-id-/g,"");if(d.saleskuPluginProductsPool.products.hasOwnProperty(a))d.saleskuPluginProductsPool.products[a].on()})},off:function(a){a.length&&a.find(".salesku-id").each(function(){var a=d(this).attr("id").replace(/salesku-id-/g,"");d.saleskuPluginProductsPool.products.hasOwnProperty(a)&&d.saleskuPluginProductsPool.products[a].off()})},
    _bind:function(a,b,c){a=a||"";b=b||"click";c={selector:a,action:b,_function:c||""};a=a.trim()+""+b.trim();this.binds[a]=c},_unbind:function(a,b){b=b||"click";var c=(a||"").trim()+""+b.trim();this.binds.hasOwnProperty(c)&&delete this.binds[c]},bindOff:function(a,b,c){c=c||"click";a=a||"";b=b||d(document);this._bind(a,c,this.bind(function(){var a=this;d(a.selector).bind(a.action,function(){d.saleskuPluginProductsPool.off(d(a.product_list_selector))})},{selector:a,product_list_selector:b,action:c}))},
    bindOn:function(a,b,c){c=c||"click";a=a||"";b=b||d(document);this._bind(a,c,this.bind(function(){var a=this;d(a.selector).bind(a.action,function(){d.saleskuPluginProductsPool.on(d(a.product_list_selector))})},{selector:a,product_list_selector:b,action:c}))},getListClass:function(a){a=a.attr("class").split(" ");for(var b in a){var c=a[b];if(/salesku_plugin_product_list-/.test(c))return c}return""},setSettings:function(a){for(var b in a)this[b]=a[b]},getFeatureHideClass:function(a){return 1==parseInt(a)?
        this.smart_sku_class_grey:2==parseInt(a)?this.smart_sku_class_hide:""},changeFeature:function(a,b){if(!b.isRelatedSku()||!this.isInit())return!1;var c=this;if(!this.current_change_product)this.current_change_product=b;else if(b.getUid()==this.current_change_product.getUid())return;var e=function(a,b){var e=a.get(0).tagName;if("INPUT"==e){var f=!1;a.closest(".inline-select").find("a").each(function(){var a=d(this).data("value");b!=a||d(this).hasClass(c.getFeatureHideClass(1))||d(this).hasClass(c.getFeatureHideClass(2))||
    (f=!0)});if(f)return a.closest(".inline-select").find("a").each(function(){var a=d(this).data("value");b==a?(d(this).addClass("selected"),d(this).removeClass(c.getFeatureHideClass(1)).removeClass(c.getFeatureHideClass(2))):d(this).removeClass("selected")}),a.val(b),!0}else if("SELECT"==e&&(e=a.find('option[value="'+b+'"]'),e.val()==b&&!e.hasClass(c.getFeatureHideClass(1))&&!e.hasClass(c.getFeatureHideClass(2))))return a.find('option[value="'+b+'"]').removeClass(c.getFeatureHideClass(1)).removeClass(c.getFeatureHideClass(1)),
        a.val(b),!0;return!1},k=a.data("feature-id"),l=a.val(),h;for(h in this.products){var f=this.products[h];if(f.getType()==b.getType()&&f.getUid()!=b.getUid()){var g=f.getForm().find('[name="features['+k+']"]');g&&g.hasClass("sku-feature")&&e(g,l)&&f.setSkuByFeature(g)}}this.current_change_product=!1},bind:function(a,b){var c=[].slice.call(arguments,2);return function(){var d=[].slice.call(arguments);d=c.concat(d);return a.apply(b,d)}},setLogMessage:function(a){console.log(a+"\n");var b=this.debug_messages;
        var c=Math.random().toString(36).substr(2)+Math.random().toString(36).substr(2);b[c]=a},getLogMessages:function(a){return this.debug_messages.join((a||"\n ")+" ")},count:function(a,b){var c,d=0;"COUNT_RECURSIVE"==b&&(b=1);1!=b&&(b=0);for(c in a)d++,1!=b||!a[c]||a[c].constructor!==Array&&a[c].constructor!==Object||(d+=this.count(a[c],1));return d}};d(document).ready(function(){d.saleskuPluginProductsPool.init()})})(jQuery);