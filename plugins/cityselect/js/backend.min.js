function shopCityselectBackend(){var s=this;s.token="",s.bounds="city",s.find={country:'[name$="country]"]',region:'[name$="region]"]',city:'[name$="city]"]',zip:'[name$="zip]"]',street:'[name$="street]"]'},s.color_timer=0,s.addColor=function(t){clearTimeout(s.color_timer),t.addClass("b-cityselect__green"),s.color_timer=setTimeout(function(){$(".b-cityselect__green").removeClass("b-cityselect__green")},1e3)},s.initAddress=function(t){t.addClass("i-cityselect__wa--init");t.find(s.find.country);var a=t.find(s.find.city),o=t.find(s.find.street),d=t.find(s.find.zip);a.length&&a.suggestions({token:s.token,type:"ADDRESS",hint:!1,bounds:s.bounds,constraints:{label:""},formatSelected:function(t){return t.data.settlement?t.data.settlement:t.data.city},onSelect:function(t){var e=a.closest(".i-cityselect__wa--init").find(s.find.region);if(e.length&&t.data.region_kladr_id&&(e.val(String(t.data.region_kladr_id).substr(0,2)).change(),s.addColor(e)),t.data.postal_code&&d.length&&(d.val(t.data.postal_code),s.addColor(d)),o.length){var n=o.suggestions(),i={};t.data.kladr_id?i.kladr_id=t.data.kladr_id:t.data.settlement?i.settlement=t.data.settlement:i.city=t.data.city,n.setOptions({constraints:{locations:i}})}}}),o.length&&s.initStreet(o,a,d)},s.initStreet=function(t,e,n){var i={};e.length&&(i.city=String(e.val()).trim()),t.suggestions({token:s.token,type:"ADDRESS",constraints:{label:"",locations:i},restrict_value:!0,onSelect:function(t){t.data.postal_code&&n.length&&(n.val(t.data.postal_code),s.addColor(n))}})},s.initFields=function(){$("#order-edit-form .field-address").not(".i-cityselect__wa--init").each(function(){s.initAddress($(this))}),$("#new-customer-form .field-address").not(".i-cityselect__wa--init").each(function(){s.initAddress($(this))})},s.init=function(t,e){s.token=t,s.bounds=e,s.initFields()},$(document).on("afterReload",function(){s.initFields()}),$(document).ajaxSuccess(function(t,e,n){-1!=n.url.indexOf("?module=customers&action=add")&&s.initFields()})}var shop_cityselect__backend=new shopCityselectBackend;