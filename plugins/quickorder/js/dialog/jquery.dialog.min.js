if(void 0===igaponovDialog)var igaponovDialog=function(o){return(igaponovDialog=function(i){this.locale=i.locale||"ru_RU",this.messages={ru_RU:{Save:"Сохранить",or:"или",cancel:"отмена","Something wrong":"Произошла ошибка","Fill in required fields":"Заполните обязательные поля","Your title":"Ваш заголовок"}},void 0!==i.messages&&"object"==typeof i.messages&&o.extend(this.messages,i.messages),this.$wrapper=i.html?o(i.html):"",this.url=i.url||"",(this.url&&!this.$wrapper||i.loadingContent)&&(this.$wrapper=o('<div class="ig-dialog-wrap is-full-screen"><div class="w-dialog-background"></div><div class="w-dialog-wrapper"><div class="w-dialog-block gray-header compact-header"><i class="big-loader"></i></div></div></div>')),this.url||!i.content||this.$wrapper||(i.title=i.title||this.translate("Your title"),this.$wrapper=o('<div class="ig-dialog-wrap is-full-screen"><div class="w-dialog-background"></div><div class="w-dialog-wrapper"><div class="w-dialog-block gray-header compact-header"><form action="" method="post"><header class="w-dialog-header"><h1>'+i.title+'</h1></header><div class="w-dialog-content margin-block">'+i.content+'</div><footer class="w-dialog-footer"><div class="margin-block errormsg"></div><div class="t-actions"><div class="t-layout"><div class="t-column left">'+(i.buttons?i.buttons:'<input type="submit" class="button green t-button" value="'+this.translate("Save")+'"> '+this.translate("or")+' <a href="javascript:void(0)" class="js-close-dialog">'+this.translate("cancel")+"</a>")+"</div></div></div></footer></form></div></div></div>")),this.options=i,this.closeBtnTemplate=o('<svg version="1.1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 9.9 9.9"><path d="M0,8.5l3.5-3.5L0,1.4L1.4,0l3.5,3.5L8.5,0l1.4,1.4L6.4,4.9l3.5,3.5L8.5,9.9L4.9,6.4L1.4,9.9L0,8.5z"></path></svg>'),this.initVars(),this.position=i.position||!1,this.dialogClass="t-"+Date.now(),this.saveUrl=i.saveUrl||"",this.is_closed=!1,this.is_locked=!1,this.xhr=!1,this.userPosition=i.setPosition||!1,this.onBgClick=i.onBgClick||!1,this.onBlockClick=i.onBlockClick||!1,this.onOpen=i.onOpen||function(){},this.onClose=i.onClose||function(){},this.onRefresh=i.onRefresh||!1,this.onResize=i.onResize||!1,this.onSubmit=i.onSubmit||null,this.onSuccess=i.onSuccess||null,this.onSuccessCallback=i.onSuccessCallback||null,this.initClass()}).prototype.initClass=function(){this.$wrapper.data("igaponovDialog",this).addClass(this.dialogClass).find(".w-dialog-background").addClass(this.dialogClass),this.show(),this.url?this.loadDataFromUrl():(this.addCloseBtn(),this.bindEvents())},igaponovDialog.prototype.loadDataFromUrl=function(){var i=this,s=i.url;i.is_locked=!0,i.xhr&&(i.xhr.abort(),i.xhr=!1),i.xhr=o.ajax({url:s,dataType:"html",type:"get",success:function(s){var t={html:s,onBgClick:function(o,s){void 0===i.options.closeOnlyByLink&&s.close()},url:""};i.close(),new igaponovDialog(o.extend(i.options,t)),i.is_locked=!1},error:function(o,s,t){i.is_locked=!1,i.close(),console&&console.log(o,s,t)}})},igaponovDialog.prototype.bindEvents=function(){var i=this,s=o(document),t=i.$block?i.$block:i.$wrapper;i.$form.on("submit",function(o){return o.preventDefault(),i.is_locked||("function"==typeof i.onSubmit?i.onSubmit(i.$form,i):i.save()),!1}),s.on("focus","input.error, textarea.error",function(){o(this).removeClass("error")}),setTimeout(function(){function e(){i.is_closed||i.close(),s.off("wa_before_load",e)}s.on("wa_before_load",e),i.$wrapper.on("close",e),i.is_full_screen&&i.$wrapper.off("click").on("click",function(o){i.onBgClick?i.onBgClick(o,i):o.stopPropagation()}),t.off("click").on("click",function(o){i.onBlockClick?i.onBlockClick(o,i):o.stopPropagation()}),o(document).on("keyup",function(o){27===o.keyCode&&i.close()}),t.off("click",".js-close-dialog").on("click",".js-close-dialog",function(){e()}),i.is_full_screen&&o(window).on("resize",function s(){var t=o.contains(document,i.$wrapper[0]);t?i.resize():o(window).off("resize",s)})},0)},igaponovDialog.prototype.addCloseBtn=function(){if(this.$closeBtn.length&&!this.$wrapper.find(".ig-dialog-close-btn").length){var o=this.$closeBtn;"object"==typeof this.$closeBtn&&(o=this.$closeBtn.prop("outerHTML")),o='<div class="ig-dialog-close-btn js-close-dialog">'+o+"</div>",this.$block.append(o)}},igaponovDialog.prototype.initVars=function(){this.$block=!!this.options.block&&o(this.options.block),this.$form=this.$wrapper.find("form"),this.$submitBtn=this.$form.find("input[type='submit']"),this.is_full_screen=this.$wrapper.hasClass("is-full-screen"),this.is_full_screen&&(this.$block=this.$wrapper.find(".w-dialog-block")),this.options.class&&this.$block.addClass(this.options.class),!1===this.$block&&(this.$block=this.$wrapper),this.$closeBtn=this.options.closeBtn?!0===this.options.closeBtn?this.closeBtnTemplate:o(this.options.closeBtn):""},igaponovDialog.prototype.show=function(){o("body").addClass("igaponov-dialog").append(this.$wrapper),this.url||this.onOpen(this.$wrapper,this)},igaponovDialog.prototype.setPosition=function(){var i,s=o(window),t=s.width(),e=this.is_full_screen?s.height():o(document).height(),n=this.$block?this.$block:this.$wrapper,l=n.outerWidth(),a=n.outerHeight();this.position?i=this.position:i=(this.userPosition?this.userPosition:function(o){return{left:parseInt((t-o.width)/2),top:parseInt((e-o.height)/2)}})({width:l,height:a});if(i.left>0&&i.left+l>t&&(i.left=t-l-10),i.top>0)i.top+a>e&&(i.top=e-a-10);else if(i.top=10,this.is_full_screen){var r=n.find(".w-dialog-content");r.hide();var c=n.outerHeight(),h=e-c-20;r.height(h).addClass("is-long-content").show()}n.css(i)},igaponovDialog.prototype.close=function(){this.is_closed=!0,this.url||this.onClose(this.$wrapper,this),this.$wrapper.remove(),o("body").removeClass("igaponov-dialog")},igaponovDialog.prototype.refresh=function(i){var s=o.extend(this.options,i);this.onRefresh?this.onRefresh(s):new igaponovDialog(s),this.close()},igaponovDialog.prototype.resize=function(){this.$block.addClass("is-animated"),this.onResize&&this.onResize(this.$wrapper,this)},igaponovDialog.prototype.translate=function(o){return void 0!==this.messages[this.locale]&&this.messages[this.locale][o]?this.messages[this.locale][o]:o},igaponovDialog.prototype.save=function(i,s){var t=this,e=null;if(!t.is_locked){if(t.$submitBtn.after("<i class='icon16 loading'></i>"),t.is_locked=!0,l(),e&&clearTimeout(e),t.$form.find(".w-dynamic-content").html(""),!function(){var i=0;if(t.$form.find(".s-required").each(function(){var s=o(this);""==o.trim(s.val())&&(s.addClass("error"),i=1)}),i)return l(t.translate("Fill in required fields")),!1;return!0}())return t.is_locked=!1,n(),!1;i=i||t.$form.serializeArray(),o.ajax({url:t.saveUrl,dataType:"json",type:"post",data:i,success:function(o){if(t.is_locked=!1,n(),void 0!==o&&"fail"==o.status&&o.errors)l(o.errors);else{"function"==typeof t.onSuccess?t.onSuccess(t,o):(t.$submitBtn.after("<i class='icon16 yes'></i>"),e=setTimeout(function(){n()},3e3));try{"function"==typeof t.onSuccessCallback&&t.onSuccessCallback(o),"function"==typeof s&&s.call(this,t)}catch(o){console.log("Callback error: "+o.message,o)}}t.resize()},error:function(o,i,s){t.is_locked=!1,n(),console&&console.log(o,i,s),l(t.translate("Something wrong"))}})}function n(){t.$submitBtn.next("i").remove()}function l(o){o=o||"",t.$form.find(".errormsg").html(o)}},igaponovDialog}(jQuery);