window.shopSkOneclick||(shopSkOneclick=function(e){"use strict";var n=function(e){this.init(e)};return n.prototype={"_config":{"block":".js-sk-oneclick-block","content":".js-sk-oneclick-content","yandexId":"","yandexOpen":"","yandexSend":"","yandexError":"","googleOpenCategory":"","googleOpenAction":"","googleSendCategory":"","googleSendAction":"","googleErrorCategory":"","googleErrorAction":""},"init":function(n){var o=this;if(o.params=e.extend({},o._config,n),o.initElements(),!o.elements.block.size())return!1;o.onEventOpen(),o.onEventCLose()},"initElements":function(){var n=this,o={};o.block=e(n.params.block),o.content=e(n.params.content),n.elements=o},"initForm":function(){var e=this,n=e.elements;n.form=n.content.find(".js-sk-oneclick-form"),n.formField=n.form.find(".wa-field").not(".wa-field-address").add(".wa-field-address .field"),n.cart=n.content.find(".js-sk-oneclick-cart"),n.counter=n.content.find(".js-sk-oneclick-counter"),n.counterInput=n.content.find(".js-sk-oneclick-counter-input"),n.cartError=n.content.find(".js-sk-oneclick-cart-error"),n.cartItem=n.content.find(".js-sk-oneclick-cart-item"),n.preload=n.content.find(".js-sk-oneclick-preloader-form"),n.formError=n.content.find(".js-sk-oneclick-form-error"),n.services=n.content.find(".js-sk-oneclick-cart-service"),n.discount=n.form.find(".js-sk-oneclick-final-discount"),n.discountPrice=n.form.find(".js-sk-oneclick-final-discount-price"),n.totalPrice=n.form.find(".js-sk-oneclick-total-price"),n.coupon=n.form.find(".js-sk-oneclick-final-coupon"),n.couponLink=n.coupon.find(".js-sk-oneclick-final-coupon-link"),n.couponInput=n.coupon.find(".js-sk-oneclick-final-coupon-input"),n.couponBlock=n.coupon.find(".js-sk-oneclick-final-coupon-block"),n.couponApply=n.coupon.find(".js-sk-oneclick-final-coupon-apply"),n.couponClear=n.coupon.find(".js-sk-oneclick-final-coupon-clear")},"initCounters":function(){var n=this,o=n.elements,t=o.counter,r=1;t.each(function(){var o=e(this),t=o.find(".js-sk-oneclick-counter-input"),a=o.find(".js-sk-oneclick-counter-left"),i=o.find(".js-sk-oneclick-counter-right");a.on("click",function(){r=parseInt(t.val());var e=r-1;e<=1&&(e=1),t.val(e),n.onReloadCart(t,r)}),i.on("click",function(){r=parseInt(t.val());var e=r+1;t.val(e),n.onReloadCart(t,r)}),t.on("focusin",function(){r=e(this).val()}),t.on("change",function(){var e=parseInt(t.val());isNaN(parseInt(e))&&(t.val("1"),r=1),n.onReloadCart(t,r)})})},"initServices":function(){var e=this;e.elements.services.find("[type=checkbox]").change(function(){e.onReloadCart()})},"runMask":function(){var n=this,o=n.elements,t=/#/g;void 0!==n.fields&&e.each(n.fields,function(e,n){if(void 0!==n.mask&&n.mask){var r=o.form.find("input[name='customer[phone]']");r.size()&&!r.val()&&r.skmask(n.mask.replace(t,"9"))}})},"onEventOpen":function(){var e=this;e.elements.block.on("event-open",function(n,o){e.requestForm(o),e.sendEventYandex(e.params.yandexOpen),e.sendEventGoogle(e.params.googleOpenCategory,e.params.googleOpenAction)})},"onEventCLose":function(){var e=this,n=e.elements;n.block.on("event-close",function(e,o){n.content.html("")})},"requestForm":function(n){var o=this,t=o.elements;o.params.type=n.type;var r=n.form.serialize()+"&type="+n.type+"&check=skonclick_plugin";e.post(o.params.urlRequest,r,function(e){"fail"==e.status?(t.block.trigger("event-load"),t.content.html(e.errors[0])):"ok"==e.status&&(t.block.trigger("event-load"),t.content.html(e.data.content),o.initForm(),o.runStyler(),o.initCounters(),o.initServices(),o.onSubmit(),o.runCoupon(),o.runMask())},"json")},"runCoupon":function(){var e=this,n=e.elements;n.couponLink.on("click",function(){n.coupon.addClass("_show-coupon")}),n.couponApply.on("click",function(){e.onReloadCart()}),n.couponClear.on("click",function(){n.coupon.removeClass("_is-coupon").removeClass("_show-coupon"),n.couponInput.val(""),e.onReloadCart()})},"onReloadCart":function(n,o){var t=this,r=t.elements;t.removeError(),e.post(t.params.urlRequest,r.form.serialize()+"&reload=1&type="+t.params.type+"&check=skonclick_plugin",function(a){"fail"==a.status?(r.cartError.text(a.errors[0]).show(),void 0!==n&&void 0!==o&&n.val(o)):"ok"==a.status&&(e.each(a.data.items,function(e,n){t.elements.cartItem.filter("[data-sku-id='"+n.sku_id+"']").find(".js-sk-oneclick-cart-total").html(n.full_price)}),parseInt(a.data.discount_numeric)?r.discount.show():r.discount.hide(),parseInt(a.data.discount_numeric)&&a.data.coupon_code?r.coupon.addClass("_is-coupon"):r.coupon.removeClass("_is-coupon").removeClass("_show-coupon"),r.discountPrice.html("- "+a.data.discount),r.totalPrice.html(a.data.total))})},"onSubmit":function(){var n=this,o=n.elements,t=!1;n.elements.form.on("submit",function(r){if(r.preventDefault(),t)return!1;t=!0,o.preload.addClass("_show"),n.removeError(),n.sendEventYandex(n.params.yandexSend),n.sendEventGoogle(n.params.googleSendCategory,n.params.googleSendAction),e.post(n.params.urlSave,n.elements.form.serialize()+"&check=skonclick_plugin",function(r){"fail"==r.status?(void 0!==r.errors.cart&&r.errors.cart&&o.cartError.text(r.errors.cart).show(),"undefined"!==r.errors.console&&r.errors.console&&console.log(r.errors.console),"undefined"!==r.errors.validate&&r.errors.validate&&e.each(r.errors.validate,function(e,n){e=parseInt(e);var t=o.formField.eq(e);if(!t.size())return console.log("Не найдено поле ошибки"),!0;t.addClass("_error"),t.find(".wa-value").size()?t.find(".wa-value").append('<em class="wa-error-msg">'+n+"</em>"):t.append('<em class="wa-error-msg">'+n+"</em>")}),"undefined"!==r.errors.form&&r.errors.form&&o.formError.text(r.errors.form[0]).show(),n.sendEventYandex(n.params.yandexError),n.sendEventGoogle(n.params.googleErrorCategory,n.params.googleErrorAction),t=!1):"ok"==r.status?(o.content.html(r.data.content),n.onClose(),"cart"==n.params.type&&setTimeout(function(){window.location=window.location},3e3)):(console.log("Произошла неизвестная ошибка"),n.sendEventYandex(n.params.yandexError),n.sendEventGoogle(n.params.googleErrorCategory,n.params.googleErrorAction)),o.preload.removeClass("_show")},"json")})},"removeError":function(){var e=this,n=e.elements;n.cartError.hide(),n.formField.removeClass("_error"),n.formField.find(".wa-error-msg").detach(),n.formError.html("").hide()},"runStyler":function(){var n=this,o=n.elements;void 0!==e.fn.styler&&o.form.find('input[type="checkbox"], input[type="radio"], .js-select').styler()},"sendEventYandex":function(e){var n=this;if(n.params.yandexId&&e&&void 0!==window["yaCounter"+n.params.yandexId]){var o=window["yaCounter"+n.params.yandexId];void 0!==o&&void 0!==o.reachGoal&&o.reachGoal(e)}},"sendEventGoogle":function(e,n){e&&n&&"undefined"!=typeof ga&&ga("send","event",e,n)},"onClose":function(){var e=this;e.elements.block.on("click",".js-sk-oneclick-close",function(){e.elements.block.trigger("run-close")})}},n}(jQuery)),void 0===jQuery.fn.skmask&&function(e){"function"==typeof define&&define.amd?define(["jquery"],e):e("object"==typeof exports?require("jquery"):jQuery)}(function(e){var n,o=navigator.userAgent,t=/iphone/i.test(o),r=/chrome/i.test(o),a=/android/i.test(o);e.skmask={"definitions":{"9":"[0-9]","a":"[A-Za-z]","*":"[A-Za-z0-9]"},"autoclear":!0,"dataName":"rawMaskFn","placeholder":"_"},e.fn.extend({"caret":function(e,n){var o;if(0!==this.length&&!this.is(":hidden"))return"number"==typeof e?(n="number"==typeof n?n:e,this.each(function(){this.setSelectionRange?this.setSelectionRange(e,n):this.createTextRange&&(o=this.createTextRange(),o.collapse(!0),o.moveEnd("character",n),o.moveStart("character",e),o.select())})):(this[0].setSelectionRange?(e=this[0].selectionStart,n=this[0].selectionEnd):document.selection&&document.selection.createRange&&(o=document.selection.createRange(),e=0-o.duplicate().moveStart("character",-1e5),n=e+o.text.length),{"begin":e,"end":n})},"unskmask":function(){return this.trigger("unskmask")},"skmask":function(o,i){var s,c,l,u,f,d,m,p;if(!o&&this.length>0){s=e(this[0]);var k=s.data(e.skmask.dataName);return k?k():void 0}return i=e.extend({"autoclear":e.skmask.autoclear,"placeholder":e.skmask.placeholder,"completed":null},i),c=e.skmask.definitions,l=[],u=m=o.length,f=null,e.each(o.split(""),function(e,n){"?"==n?(m--,u=e):c[n]?(l.push(new RegExp(c[n])),null===f&&(f=l.length-1),u>e&&(d=l.length-1)):l.push(null)}),this.trigger("unskmask").each(function(){function s(){if(i.completed){for(var e=f;d>=e;e++)if(l[e]&&R[e]===k(e))return;i.completed.call(_)}}function k(e){return i.placeholder.charAt(e<i.placeholder.length?e:0)}function v(e){for(;++e<m&&!l[e];);return e}function g(e){for(;--e>=0&&!l[e];);return e}function h(e,n){var o,t;if(!(0>e)){for(o=e,t=v(n);m>o;o++)if(l[o]){if(!(m>t&&l[o].test(R[t])))break;R[o]=R[t],R[t]=k(t),t=v(t)}x(),_.caret(Math.max(f,e))}}function y(e){var n,o,t,r;for(n=e,o=k(e);m>n;n++)if(l[n]){if(t=v(n),r=R[n],R[n]=o,!(m>t&&l[t].test(r)))break;o=r}}function b(){var e=_.val(),n=_.caret();if(p&&p.length&&p.length>e.length){for(S(!0);n.begin>0&&!l[n.begin-1];)n.begin--;if(0===n.begin)for(;n.begin<f&&!l[n.begin];)n.begin++;_.caret(n.begin,n.begin)}else{for(S(!0);n.begin<m&&!l[n.begin];)n.begin++;_.caret(n.begin,n.begin)}s()}function C(){S(),_.val()!=A&&_.change()}function E(e){if(!_.prop("readonly")){var n,o,r,a=e.which||e.keyCode;p=_.val(),8===a||46===a||t&&127===a?(n=_.caret(),o=n.begin,r=n.end,r-o==0&&(o=46!==a?g(o):r=v(o-1),r=46===a?v(r):r),w(o,r),h(o,r-1),e.preventDefault()):13===a?C.call(this,e):27===a&&(_.val(A),_.caret(0,S()),e.preventDefault())}}function j(n){if(!_.prop("readonly")){var o,t,r,i=n.which||n.keyCode,c=_.caret();if(!(n.ctrlKey||n.altKey||n.metaKey||32>i)&&i&&13!==i){if(c.end-c.begin!=0&&(w(c.begin,c.end),h(c.begin,c.end-1)),o=v(c.begin-1),m>o&&(t=String.fromCharCode(i),l[o].test(t))){if(y(o),R[o]=t,x(),r=v(o),a){var u=function(){e.proxy(e.fn.caret,_,r)()};setTimeout(u,0)}else _.caret(r);c.begin<=d&&s()}n.preventDefault()}}}function w(e,n){var o;for(o=e;n>o&&m>o;o++)l[o]&&(R[o]=k(o))}function x(){_.val(R.join(""))}function S(e){var n,o,t,r=_.val(),a=-1;for(n=0,t=0;m>n;n++)if(l[n]){for(R[n]=k(n);t++<r.length;)if(o=r.charAt(t-1),l[n].test(o)){R[n]=o,a=n;break}if(t>r.length){w(n+1,m);break}}else R[n]===r.charAt(t)&&t++,u>n&&(a=n);return e?x():u>a+1?i.autoclear||R.join("")===I?(_.val()&&_.val(""),w(0,m)):x():(x(),_.val(_.val().substring(0,a+1))),u?n:f}var _=e(this),R=e.map(o.split(""),function(e,n){return"?"!=e?c[e]?k(n):e:void 0}),I=R.join(""),A=_.val();_.data(e.skmask.dataName,function(){return e.map(R,function(e,n){return l[n]&&e!=k(n)?e:null}).join("")}),_.one("unskmask",function(){_.off(".skmask").removeData(e.skmask.dataName)}).on("focus.skmask",function(){if(!_.prop("readonly")){clearTimeout(n);var e;A=_.val(),e=S(),n=setTimeout(function(){_.get(0)===document.activeElement&&(x(),e==o.replace("?","").length?_.caret(0,e):_.caret(e))},10)}}).on("blur.skmask",C).on("keydown.skmask",E).on("keypress.skmask",j).on("input.skmask paste.skmask",function(){_.prop("readonly")||setTimeout(function(){var e=S(!0);_.caret(e),s()},0)}),r&&a&&_.off("input.skmask").on("input.skmask",b),S()})}})});