if("undefined"==typeof jQuery){var script=document.createElement("script");script.src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js",document.getElementsByTagName("head")[0].appendChild(script)}var FlexdiscountPluginFrontend=function(t){return(FlexdiscountPluginFrontend=function(e){this.$couponResultField=t(".flexdiscount-coup-result"),this.$couponForm=t(".flexdiscount-form"),this.urls=e.urls||{},this.couponCode=e.couponCode||"",this.locale=e.locale||"",this.settings=e.settings||{},this.shopVersion=parseFloat(e.shopVersion)||0,this.loaderType=e.loaderType||"loader1",this.hideDefaultAffiliateBlock=parseInt(e.hideDefaultAffiliateBlock)||0,this.addAffiliateBlock=parseInt(e.addAffiliateBlock)||0,this.updateInfoblocks=parseInt(e.updateInfoblocks),this.addActiveDiscountsBlock=parseInt(e.addActiveDiscountsBlock)||0,this.ss8forceUpdate=parseInt(e.ss8forceUpdate)||0,this.ss8UpdateAfterPayment=e.ss8UpdateAfterPayment||!1,this.productIds={},this.wrapElements=[".dialog",".modal",".s-dialog-wrapper"],this.cartTotalElements=[".cart-total",".js-cart-total","#cart-total"],this.cartAffiliateBlock=[".affiliate",".s-affiliate-hint-wrapper",".affiliate-text",".bonus-count"],this.$affiliateHolder=t(".fl-affiliate-holder"),this.$affiliateParentBlock={},this.xhr=this.xhrCart={},this.qtyTimer=null,this.cartTimer=null,this.messages={ru_RU:{"Coupon code is correct":"Купон активирован","Coupon code is incorrect":"Купон не существует"}},this.isOnestepCheckout=this.shopVersion>=8&&t("#js-order-cart").length,this.initClass()}).prototype.initClass=function(){var t=this;t.$couponForm.length&&""!==t.couponCode&&(t.$couponForm.find(".flexdiscount-coupon-code").val(t.couponCode),t.$couponForm.find(".flexdiscount-coup-del-block").show()),t.findAffiliateParent(),t.hideDefaultAffiliateBlock?t.$affiliateParentBlock.remove():t.$affiliateHolder.length&&t.$affiliateHolder.hasClass("fl-hide-block")&&t.$affiliateParentBlock.hide().find(".icon16-flexdiscount").replaceWith(0),t.bindEvents(),t.isOnestepCheckout&&setTimeout(function(){t.initSS8()},500)},FlexdiscountPluginFrontend.prototype.initSS8=function(){if(t("#js-order-page").length||t("#js-order-cart").length){var e=t("#js-order-cart").data("controller");void 0!==this.settings.enable_frontend_cart_hook&&parseInt(this.settings.enable_frontend_cart_hook)&&void 0!==e&&(this.$couponForm=t(this.settings.coupon_form),e.$coupon_section.length?e.$coupon_section.append(this.$couponForm):(e.$outer_wrapper.find(".wa-cart-details .wa-column-content").prepend('<div class="wa-coupon-section"></div>'),e.$outer_wrapper.find(".wa-coupon-section").append(this.$couponForm)),this.$couponForm.length&&""!==this.couponCode&&(this.$couponForm.find(".flexdiscount-coupon-code").val(this.couponCode),this.$couponForm.find(".flexdiscount-coup-del-block").show())),this.bindSS8(),this.ss8forceUpdate&&this.updateOnestepForm()}},FlexdiscountPluginFrontend.prototype.updateOnestepForm=function(){var e=t("#js-order-form").data("controller");void 0!==e&&e.update()},FlexdiscountPluginFrontend.prototype.bindSS8=function(){var e=this;if(t(document).on("wa_order_cart_rendered","#js-order-cart",function(){e.cartChange()}),t(document).on("wa_order_form_changed","#js-order-form",function(){e.cartChange()}),e.ss8UpdateAfterPayment){var i=!1;t(document).on("wa_order_form_payment_changed","#js-order-form",function(){var a=t("#js-order-form .wa-type-wrapper.is-active");!i&&a.length?setTimeout(function(){0===t.active&&t("#wa-step-payment-section").is(":visible")&&(e.updateOnestepForm(),i=!0)},100):i=!1})}},FlexdiscountPluginFrontend.prototype.bindEvents=function(){var e=this;t(document).on("click",".flexdiscount-submit-button",function(){var i=t(this),a=i.closest(".flexdiscount-form").find(".flexdiscount-coupon-code"),o=t.trim(a.val());return i.attr("disabled","disabled"),e.addLoading(i),t.post(e.urls.couponAddUrl,{coupon:o},function(t){var a=i.closest("form"),o=a.length?void 0!==a.attr("data-flexdiscount-action")?a.attr("data-flexdiscount-action"):a.attr("action"):"";o=void 0!==o&&""!==o&&"about:blank"!==o?o:location.href,i.removeAttr("disabled"),e.$couponResultField.length?("ok"==t.status?(e.$couponResultField.removeClass("flexdiscount-error").html(e.translate("Coupon code is correct")+" <i class='icon16-flexdiscount loading'></i>"),location.href=o):e.$couponResultField.addClass("flexdiscount-error").html(e.translate("Coupon code is incorrect")),e.removeLoading()):location.href=o},"json"),!1}),t(document).on("click",".flexdiscount-coupon-delete",function(){var i=t(this);return e.hasLoading(i)||(e.addLoading(i),t.post(e.urls.deleteUrl,function(){i.closest(".flexdiscount-coup-del-block").hide().closest(".flexdiscount-form").find(".flexdiscount-coupon-code").val(""),location.reload()},"json")),!1}),t(document).on("change","form, .flexdiscount-product-form",function(){var i=t(this),a=i.find("input[name='product_id']");a.length&&(e.productIds[a.val()]=i,clearTimeout(i.data("flexdiscount-timer")),i.data("flexdiscount-timer",setTimeout(function(){if(!t.isEmptyObject(e.productIds)){var i=e.productIds;e.productIds={},e.updateProductRules(i)}},600)))}),t(document).on("click","a.plus, a.minus, .inc_cart, .dec_cart, .inc_product, .dec_product.dec_product",function(){var i=t(this);clearTimeout(e.qtyTimer),e.qtyTimer=setTimeout(function(){i.closest("form").change()},100)}),t(document).on("wa_order_cart_rendered","#js-order-cart",function(){e.cartChange()}),e.isOnestepCheckout||t(document).ajaxComplete(function(t,i,a){return void 0!==a&&void 0!==a.url&&(e.endsWith(e.urls.cartSaveUrl.shop,a.url)||e.endsWith(e.urls.cartAddUrl.shop,a.url)||e.endsWith(e.urls.cartDeleteUrl.shop,a.url)||e.endsWith(e.urls.cartSaveUrl.plugin,a.url)||e.endsWith(e.urls.cartAddUrl.plugin,a.url)||e.endsWith(e.urls.cartDeleteUrl.plugin,a.url))&&e.cartChange(),!0})},FlexdiscountPluginFrontend.prototype.endsWith=function(t,e){return t.substring(t.length-e.length,t.length)===e},FlexdiscountPluginFrontend.prototype.updateProductRules=function(e){var i=this;if(i.updateInfoblocks){var a=null,o=0,n={},d={},s={},r={},l={},c={};t.each(e,function(e,n){null===a&&(a=e);var f=n.find("input[name='quantity']").val();f=f||1;var p=i.findWrap(n);d[e]=p.find(".flexdiscount-available-discount.product-id-"+e);var h=u(d[e]);s[e]=p.find(".flexdiscount-product-discount.product-id-"+e);var v=u(s[e]);r[e]=p.find(".flexdiscount-price-block.product-id-"+e);var m=u(r[e]);l[e]=p.find(".flexdiscount-deny-discount.product-id-"+e);var g=u(l[e]);c[e]={quantity:f,available_discounts:h,p_discounts:v,price_blocks:m,deny_discounts:g,params:n.serialize()},void 0===i.xhr[e]||t.isEmptyObject(i.xhr[e])||4==i.xhr[e].readyState||i.xhr[e].abort(),o++}),1===o&&(n=i.xhr),n[a]=t.ajax({type:"post",url:i.urls.updateDiscountUrl,cache:!1,dataType:"json",beforeSend:function(t){1===o&&(i.xhr[a]=t)},data:{products:c},success:function(e){"ok"==e.status&&e.data&&void 0!==e.data.products?t.each(e.data.products,function(t,a){i.updateDiscountBlocks(d[t],"available_discounts",a,t,e),i.updateDiscountBlocks(s[t],"p_discounts",a,t,e),i.updateDiscountBlocks(r[t],"price_blocks",a,t,e),i.updateDiscountBlocks(l[t],"deny_discounts",a,t,e)}):i.removeLoader(t(document))},error:function(e,a,o){"abort"!==a&&(console&&console.log(e,a,o),i.removeLoader(t(document)))},complete:function(){delete n[a]}})}function u(e){var a={};return e.length&&e.each(function(){var e=t(this),o=e.hasClass("f-update-sku")?"find":e.attr("data-sku-id"),n=void 0!==e.attr("data-view-type")?e.attr("data-view-type"):0;void 0===a[o]&&(a[o]={}),a[o][n]=e.hasClass("flexdiscount-available-discount")&&void 0!==e.attr("data-filter-by")?e.attr("data-filter-by"):n,i.addLoader(e)}),a}},FlexdiscountPluginFrontend.prototype.updateAllRules=function(e){var i=this;if(i.updateInfoblocks){var a=(e=e||t(document)).find(".flexdiscount-available-discount"),o=e.find(".flexdiscount-product-discount"),n=e.find(".flexdiscount-price-block"),d=e.find(".flexdiscount-deny-discount"),s=function(e){var a={};return e.length&&e.each(function(){var e=t(this),o=e.hasClass("flexdiscount-available-discount")?"available_discounts":e.hasClass("flexdiscount-product-discount")?"p_discounts":e.hasClass("flexdiscount-price-block")?"price_blocks":e.hasClass("flexdiscount-deny-discount")?"deny_discounts":"",n=void 0!==e.attr("data-product-id")?parseInt(e.attr("data-product-id")):0;if(n>0&&""!==o){if(void 0===a[n]){var d=i.findWrap(e,""),s=d.length?d.find("form"):e;a[n]={quantity:s.find("input[name='quantity']").length?s.find("input[name='quantity']").val():1,available_discounts:{},p_discounts:{},price_blocks:{},deny_discounts:{},params:s.serialize()}}var r=e.hasClass("f-update-sku")?"find":e.attr("data-sku-id"),l=void 0!==e.attr("data-view-type")?e.attr("data-view-type"):0;void 0===a[n][o][r]&&(a[n][o][r]={}),a[n][o][r][l]=e.hasClass("flexdiscount-available-discount")&&void 0!==e.attr("data-filter-by")?e.attr("data-filter-by"):l,i.addLoader(e)}}),a}(a.add(o).add(n).add(d));t.isEmptyObject(i.xhr)||4!=i.xhr.readyState&&i.xhr.abort(),i.xhr=t.ajax({type:"post",url:i.urls.updateDiscountUrl,cache:!1,dataType:"json",data:{products:s},success:function(e){"ok"==e.status&&e.data&&void 0!==e.data.products?t.each(e.data.products,function(t,s){i.updateDiscountBlocks(a.filter(".product-id-"+t),"available_discounts",s,t,e),i.updateDiscountBlocks(o.filter(".product-id-"+t),"p_discounts",s,t,e),i.updateDiscountBlocks(n.filter(".product-id-"+t),"price_blocks",s,t,e),i.updateDiscountBlocks(d.filter(".product-id-"+t),"deny_discounts",s,t,e)}):i.removeLoader(t(document))},error:function(e,a,o){"abort"!==a&&(console&&console.log(e,a,o),i.removeLoader(t(document)))},complete:function(){i.xhr={}}})}},FlexdiscountPluginFrontend.prototype.removeLoading=function(){var e=t(".icon16-flexdiscount.loading");e.length&&e.remove()},FlexdiscountPluginFrontend.prototype.addLoading=function(t){t.after("<i class='icon16-flexdiscount loading'></i>")},FlexdiscountPluginFrontend.prototype.hasLoading=function(t){return!!t.next(".icon16-flexdiscount.loading").length},FlexdiscountPluginFrontend.prototype.hideLoading=function(t){t.next(".icon16-flexdiscount.loading").remove()},FlexdiscountPluginFrontend.prototype.addLoader=function(t){switch(this.removeLoader(t),this.loaderType){case"loader1":var e='<div class="align-center flexdiscount-loader" style="display: block"><i class="flexdiscount-big-loading"></i></div>';t.find(".flexdiscount-interactive").length?t.find(".flexdiscount-interactive").hide().before(e):(t.children().hide(),t.append(e));break;case"loader2":t.addClass("fl-is-loading");break;case"loader3":t.addClass("fl-is-loading fl-loader-2")}},FlexdiscountPluginFrontend.prototype.removeLoader=function(t){"loader1"==this.loaderType?(t.find(".flexdiscount-interactive").length?t.find(".flexdiscount-interactive").show():t.children().show(),t.find(".flexdiscount-loader").remove()):t.removeClass("fl-is-loading fl-loader-2")},FlexdiscountPluginFrontend.prototype.updateDiscountBlocks=function(e,i,a,o,n){var d=this;e&&e.length&&e.each(function(){var e=t(this),s=e.hasClass("f-update-sku")?n.data.product_skus[o]:e.attr("data-sku-id"),r=void 0!==e.attr("data-view-type")?e.attr("data-view-type"):0;void 0!==a[s]&&void 0!==a[s][i]&&void 0!==a[s][i][r]&&(e.html(t(a[s][i][r]).html()),t(a[s][i][r]).hasClass("flexdiscount-show")?e.css("display",""):t(a[s][i][r]).hasClass("flexdiscount-hide")&&e.hide(),e.hasClass("f-update-sku")&&e.attr("data-sku-id",s)),d.removeLoader(e)})},FlexdiscountPluginFrontend.prototype.findWrap=function(e,i){var a=e.closest(".flexdiscount-product-wrap, .igaponov-product-wrap"+(this.wrapElements.length?", "+this.wrapElements.join(","):""));if(!a.length){var o=e.closest(".s-products-list, .product-list, .lazy-wrapper, ul.thumbnails, .product-thumbs, .product-list");o.length&&(a=t("> li, > div, > tr",o)),a.length&&a.addClass("igaponov-product-wrap")}return a.length?a:void 0!==i?i:t(document)},FlexdiscountPluginFrontend.prototype.cartChange=function(){var e=this;var i=t(".flexdiscount-cart-item"),a=t(".flexdiscount-cart-price"),o=t(".flexdiscount-user-discounts, .flexdiscount-user-affiliate"),n={fields:{},items:{},user_discounts:{},affiliate_block:{}},d=1;e.hideLoading(i),e.hideLoading(a),clearTimeout(e.cartTimer),e.cartTimer=setTimeout(function(){i.length&&(i.each(function(i){var a=t(this);if(a.length){a.addClass("c"+i),void 0===n.items[a.data("cart-id")]&&(n.items[a.data("cart-id")]={});var o=a.data("params")||{};n.items[a.data("cart-id")][a.data("block-id")]={field:a.data("field"),params:o},!o.remove_loader&&e.addLoading(a)}}),d=0),a.length&&(a.each(function(e){var i=t(this);i.length&&(i.addClass("c"+e),void 0===n.fields[i.data("cart-id")]&&(n.fields[i.data("cart-id")]={}),n.fields[i.data("cart-id")]["c"+e]={mult:i.data("mult"),html:i.data("html"),format:i.data("format")})}),e.addLoading(a),d=0),o.length&&(o.each(function(){var i=t(this),a=i.hasClass("flexdiscount-user-discounts")?"user_discounts":"affiliate_block";if("discounts"==a&&i.parent(".quickorder-fl-ad").length)return!0;n[a][i.attr("data-view-type")]=i.attr("data-view-type"),e.addLoader(i)}),d=0),!e.$affiliateParentBlock.length||e.hideDefaultAffiliateBlock||e.isOnestepCheckout||e.$affiliateParentBlock.each(function(e,i){var a=(i=t(i)).find("strong");a.length?(a.html(a.html().replace(/\+\s*\d+\.?\d*/,'<i class="icon16-flexdiscount loading fl-replace-affiliate"></i>')),d=0):-1!==i.text().search(/\+\s*\d+\.?\d*/)&&(i.html(i.html().replace(/\+\s*\d+\.?\d*/,'<i class="icon16-flexdiscount loading fl-replace-affiliate"></i>')),d=0)}),d||(t.isEmptyObject(e.xhrCart)||4!=e.xhrCart.readyState&&e.xhrCart.abort(),e.xhrCart=t.ajax({type:"post",url:e.urls.refreshCartUrl,cache:!1,dataType:"json",data:{data:n},success:function(o){var n,d;e.hideLoading(a),e.hideLoading(i),"ok"==o.status&&o.data&&(void 0!==o.data.fields&&t.each(o.data.fields,function(e,i){var a=t(i.elem);a.removeClass(i.removeClass).html(t(i.price).html()),a.data("price",i.clear_price).attr("data-price",i.clear_price),a.data("product-price",i.clear_product_price).attr("data-product-price",i.clear_product_price)}),void 0!==o.data.items&&t.each(o.data.items,function(e,i){t('.flexdiscount-cart-item[data-block-id="'+e+'"]').replaceWith(i)}),void 0!==o.data.blocks&&(n=o.data.blocks,!(d=t(".flexdiscount-user-discounts, .flexdiscount-user-affiliate")).length||void 0===n.discounts&&void 0===n.affiliate||d.each(function(){var e=t(this),i=e.hasClass("flexdiscount-user-discounts")?"discounts":"affiliate";if("discounts"==i&&e.parent(".quickorder-fl-ad").length)return!0;void 0!==n[i][e.attr("data-view-type")]&&e.replaceWith(n[i][e.attr("data-view-type")])}),e.removeLoader(d)),t(".fl-replace-affiliate").length&&!e.hideDefaultAffiliateBlock&&(void 0!==o.data.clear_affiliate&&0!==o.data.clear_affiliate?(t(".fl-replace-affiliate").siblings(".fl-affiliate-holder").remove().end().replaceWith("+"+o.data.clear_affiliate+'<span class="fl-affiliate-holder" style="display:none"></span>'),e.findAffiliateParent().show()):(t(".fl-replace-affiliate").siblings(".fl-affiliate-holder").remove().end().replaceWith('+0 <span class="fl-affiliate-holder" style="display:none"></span>'),e.findAffiliateParent().hide()))),t(document).trigger("flexdiscount-cart-updated")},error:function(i,a,o){"abort"!==a&&(console&&console.log(i,a,o),t(".fl-replace-affiliate").length&&!e.hideDefaultAffiliateBlock&&e.findAffiliateParent().hide())},complete:function(){e.xhrCart={}}}))},100)},FlexdiscountPluginFrontend.prototype.findAffiliateParent=function(){var e=this;if(e.$affiliateParentBlock=t(),e.isOnestepCheckout){var i=t("#js-order-cart").data("controller");void 0!==i&&i.$affiliate_section.length&&(e.$affiliateParentBlock=i.$affiliate_section.find("#wa-affiliate-order-bonus"))}else{var a=e.cartAffiliateBlock.length?t(""+e.cartAffiliateBlock.join(",")):"";t(".fl-affiliate-holder").each(function(){var i=t(this).closest(a);i.length||(i=t(this).parent()).is("strong")&&(i=i.parent()),e.$affiliateParentBlock=e.$affiliateParentBlock.add(i)})}return e.$affiliateParentBlock},FlexdiscountPluginFrontend.prototype.translate=function(t){return void 0!==this.messages[this.locale]&&this.messages[this.locale][t]?this.messages[this.locale][t]:t},FlexdiscountPluginFrontend}(jQuery);