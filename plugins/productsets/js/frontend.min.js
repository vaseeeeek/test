!function(t){const e={UNINITIALIZED_SET:".productsets-wrap.not-inited",LOADING:"is-loading",LOCKED:"p-is-locked",DISABLED:"p-disabled",SET:".productsets-wrap",ALTERNATIVE_BLOCK:".productsets-alternative",BUNDLE_WRAP:".productsets-wrap-inner",ACTIVE_BUNDLE:".slick-active .productsets-bundle",BUNDLE_ITEM:".productsets-bundle-item",ITEM:".productsets-item",ITEM_STATUS_CHECKBOX:".productsets-checkbox input",ITEM_IMAGE:".productsets-item-image",ITEM_NAME:".productsets-item-name",ITEM_SKU:".productsets-item-sku",ALTERNATIVE_ITEM:".js-productsets-init-alt-slider",ACTIVE_ALTERNATIVE_ITEM:".slick-active .productsets-item",SLIDE:".slick-slide",INACTIVE:"not-in-stock",DELETED:"item-deleted",ONE_VARIANT:"only-one-variant",QUANTITY_FLD:".productsets-item-quantity input",PRICE_FLD:".productsets-price",BADGE:".productsets-badge span",BADGE_FLD:".productsets-badge",COMPARE_PRICE_FLD:".productsets-compare-price",TOTAL_PRICE:".productsets-total-price",TOTAL_WRAP:".productsets-total-wrap",TOTAL_COMPARE_PRICE:".productsets-total-compare-price",TOTAL_DISCOUNT:".productsets-total-discount",TOTAL_DISCOUNT_WRAP:".productsets-total-discount-wrap",TOTAL_ITEMS:".productsets-total-items",TOTAL_ITEM:".productsets-total-item",TOTAL_ITEM_DELETE:".pti-icon",BUY_BUTTON:".productsets-bundle-buy",BUTTON_LOADING:".productsets-loading",UNINITIALIZED_BUNDLE:".productsets-bundle.not-inited",UNINITIALIZED_USERBUNDLE:".productsets-userbundle-wrap.not-inited",USERBUNDLE_WRAP:".productsets-userbundle-wrap",USERBUNDLE_TOTAL_WRAP:".productsets-userbundle-total-wrap",USERBUNDLE_TOTAL:".productsets-userbundle-total",USERBUNDLE_TOTAL_PRICE:".productsets-userbundle-total-price",USERBUNDLE_TOTAL_DISCOUNT_WRAP:".productsets-userbundle-saving-wrap",USERBUNDLE_TOTAL_DISCOUNT:".productsets-userbundle-saving",USERBUNDLE_TOTAL_QUANTITY:".productsets-userbundle-count",USERBUNDLE_INFO:".productsets-userbundle-info",USERBUNDLE_BODY:".productsets-userbundle-body",USERBUNDLE_ADD2CART_ITEM:".productsets-userbundle-add",USERBUNDLE_ADD2CART_ITEM_TEXT:".productsets-userbundle-add span",USERBUNDLE_THUMBS:".productsets-userbundle-thumbs",USERBUNDLE_GROUP:".productsets-userbundle-group-wrap",USERBUNDLE_BUY_BUTTON:".productsets-userbundle-buy",BUNDLES_WRAP:".productsets-bundles-wrap",SLICK_INITIALIZED:".slick-initialized",CONTROLLER:".productsets-controller",POPUP:".productsets-popup",POPUP_CONTENT:".productsets-popup-content",ERROR_BLOCK:".productsets-error-block",SELECTED_USERITEM:".productsets-item.locked, .productsets-item.added",FIXED:"ps-fixed"};t.productsets={init:function(e){var s=this;s.initOptions(e);let i=[{id:"igaponov-dialog-css",type:"css",uri:s.PLUGIN_URL+"js/dialog/jquery.dialog.min.css"},{id:"igaponov-dialog-js",type:"js",uri:s.PLUGIN_URL+"js/dialog/jquery.dialog.min.js"},{id:"slick-jquery-js",type:"js",uri:s.PLUGIN_URL+"js/slick/slick.min.js"},{id:"translate-js",type:"js",uri:s.PLUGIN_URL+"js/translate.js"},{id:"slick-jquery-css",type:"css",uri:s.PLUGIN_URL+"js/slick/slick.min.css"},{id:"slick-theme-jquery-css",type:"css",uri:s.PLUGIN_URL+"js/slick/slick-theme.css"}];s.loadSources(i).then(function(){"object"==typeof window.productsetsJsLocale&&(s.localeStrings=t.extend(s.localeStrings,window.productsetsJsLocale)),window.__=puttext(s.localeStrings),t(document).on("click","[data-productsets-userbundle-button]",function(){return s.show(t(this)),!1}),t(document).on("change","form",function(){setTimeout(function(){s.initSets(),s.resize()},100)}),t(window).resize(function(){s.resize()}),s.resize(),s.initSets()})},resize:function(){t(e.SET).each(function(){var e=t(this),s=e.parent().width();e.removeClass("productsets320 productsets420 productsets520 productsets570 productsets650 productsets740 productsets850"),s<=320?e.addClass("productsets320 productsets420 productsets520 productsets570 productsets650 productsets740 productsets850"):s<=420?e.addClass("productsets420 productsets520 productsets570 productsets650 productsets740 productsets850"):s<=520?e.addClass("productsets520 productsets570 productsets650 productsets740 productsets850"):s<=570?e.addClass("productsets570 productsets650 productsets740 productsets850"):s<=650?e.addClass("productsets650 productsets740 productsets850"):s<=740?e.addClass("productsets740 productsets850"):s>740&&s<=850&&e.addClass("productsets850")}),t(e.POPUP).each(function(){t(this).data("controller")&&t(this).data("controller").position()})},show:function(s){var i=this,o={product_id:s.data("productsets-product-id"),category_id:s.data("category"),set_id:s.data("productsets-set-id")},n=!1;function r(s,o){if(!t(s.target).closest(e.POPUP).length){var n=o.$wrapper.find(e.POPUP).not("."+e.LOADING);n.length&&(n.hasClass("is-success")?i.closeUserbundlePopup(n):n.data("controller").close())}}function a(t){t.$block.html(__("The set is empty")),t.$wrapper.addClass("empty-block")}new igaponovDialog({loadingContent:!0,class:"productsets-dialog",closeBtn:!0,onOpen:function(e,s){n=t.post(i.urls.load,o,function(t){"ok"==t.status&&t.data.length?(e.addClass("loaded productsets-dialog-wrapper"),s.$block.html(t.data),s.addCloseBtn(),i.initSets()):a(s)}).always(function(){e.find(".productsets-wrap").length||(a(s),e.removeClass("loaded"))})},onBgClick:function(t,e){r(t,e),void 0===s.data("popup-close")&&e.$wrapper.hasClass("loaded")||e.close()},onBlockClick:function(t,e){r(t,e),t.stopPropagation()},onClose:function(){n&&n.abort()}})},closeUserbundlePopup:function(t){let e=t.closest(".productsets-dialog-wrapper");e.length&&e.data("igaponovDialog").close()},initOptions:function(t){this.PLUGIN_URL=t.PLUGIN_URL||"",this.currency=t.currency||{},this.urls=t.urls||{},this.options=t||{},this.localeStrings=t.localeStrings||{}},initSets:function(){t(e.UNINITIALIZED_SET).each(function(){var e=t(this);void 0===e.data("controller")&&new s(e)})},loadSources:function(e){var s=t.Deferred();return function(e){var s=t.Deferred(),i=e.length,o=[];return t.each(e,function(e,s){switch(s.type){case"css":(function(e){var s=t.Deferred(),i=s.promise(),o=t("#"+e.id);return o.length?s.resolve(e):((o=t("<link />",{id:e.id,rel:"stylesheet"}).appendTo("head").data("promise",i)).on("load",function(){s.resolve(e)}).on("error",function(){s.reject(e)}),o.attr("href",e.uri)),("object"!=typeof i||"object"===i&&"function"!=typeof i.then)&&(i=s.promise()),i})(s).then(n,r);break;case"js":(function(e){var s=t.Deferred(),i=s.promise(),o=t("#"+e.id);if(o.length)s.resolve(e);else{var n=document.createElement("script");document.getElementsByTagName("head")[0].appendChild(n),(o=t(n).attr("id",e.id).data("promise",i)).on("load",function(){s.resolve(e)}).on("error",function(){s.reject(e)}),o.attr("src",e.uri)}return("object"!=typeof i||"object"===i&&"function"!=typeof i.then)&&(i=s.promise()),i})(s).then(n,r)}}),s.promise();function n(t){i-=1,a()}function r(t){o.push(t),i-=1,a()}function a(){0===i&&(o.length?s.reject(o):s.resolve())}}(e).then(function(){s.resolve()},function(t){console&&console.error&&console.error("Error loading resource",t),s.reject(t)}),s.promise()},currencyFormat:function(t,e){var s,i,o=this.currency.frac_digits,n=this.currency.decimal_point,r=this.currency.thousands_sep;isNaN(o=Math.abs(o))&&(o=2),null==n&&(n=","),null==r&&(r="."),(i=(s=parseInt(t=(+t||0).toFixed(o))+"").length)>3?i%=3:i=0;t=(i?s.substr(0,i)+r:"")+s.substr(i).replace(/(\d{3})(?=\d)/g,"$1"+r)+(o&&t-s?n+Math.abs(t-s).toFixed(o).replace(/-/,0).slice(2):"");var a=e?this.currency.sign:this.currency.sign_html;return this.currency.sign_position?t+this.currency.sign_delim+a:a+this.currency.sign_delim+t}};var s=((s=function(e){this.xhrSkus=!1,this.$set=e,this.setId=e.data("id"),this.rubleSign=e.data("ruble"),this.rubleSign="rub"==this.rubleSign?1:0,this.loading='<i class="productsets-loading"></i>',this.validateParams={popupErrors:1,$set:this.$set},this.extraParams={stickyTopOffset:150},"object"==typeof window.productsetsExtraParams&&(this.extraParams=t.extend(this.extraParams,window.productsetsExtraParams)),this.initClass(),this.bindEvents(),this.$set.removeClass("not-inited")}).prototype.initClass=function(){this.$set.data("controller",this),this.initBundles()},s.prototype.initBundles=function(){this.initBundlesSlider(),this.$set.find(e.UNINITIALIZED_BUNDLE).each(function(){new n(t(this))}),this.$set.find(e.UNINITIALIZED_USERBUNDLE).each(function(){new r(t(this))})},s.prototype.initBundlesSlider=function(){var s=this;s.$set.find(e.BUNDLES_WRAP).not(e.SLICK_INITIALIZED).each(function(){var e=t(this);e.on("init afterChange",function(i,o){e.removeClass("pl0 pr0"),e.find(".productsets-next").hasClass("slick-disabled")?e.addClass("pr0"):e.find(".productsets-prev").hasClass("slick-disabled")?e.addClass("pl0"):e.find(".productsets-next").length||e.find(".productsets-prev").length||e.addClass("pl0 pr0"),setTimeout(function(){s.update(),o.setPosition(),e.find(".js-productsets-init-alt-slider").each(function(){t(this).productsetsSlick("setPosition")})},30)}).productsetsSlick({slidesToShow:1,slidesToScroll:1,infinite:!1,prevArrow:'<div class="productsets-prev" '+t.productsets.options.attr.sliderWrapArrow+'><svg viewBox="0 0 20.3 32.2" class="productsets-icon aleft" '+t.productsets.options.attr.sliderArrow+'><use xlink:href="'+t.productsets.PLUGIN_URL+'img/svg/arrows.svg#arrow-left"></use></svg></div></div>',nextArrow:'<div class="productsets-next" '+t.productsets.options.attr.sliderWrapArrow+'><svg viewBox="0 0 20.3 32.2" class="productsets-icon aright" '+t.productsets.options.attr.sliderArrow+'>    <use xlink:href="'+t.productsets.PLUGIN_URL+'img/svg/arrows.svg#arrow-right"></use>  </svg></div>',appendArrows:e,draggable:!1,lazyLoad:"ondemand",cssEase:"linear",adaptiveHeight:!0})})},s.prototype.bindEvents=function(){var s=this;t(document).off("click",e.BUY_BUTTON).on("click",e.BUY_BUTTON,function(){s.submitForm(t(this).closest(e.SET).find(e.ACTIVE_BUNDLE).data("controller"))}),t(document).off("click.productsets-popup").on("click.productsets-popup",function(s){if(!t(s.target).closest(e.POPUP).length){var i=t(s.target).closest(e.SET).find(e.POPUP).not("."+e.LOADING);i.length&&i.data("controller").close()}}),t(document).off("click",e.BUNDLES_WRAP+" .js-productsets-quantity-trigger").on("click",e.BUNDLES_WRAP+" .js-productsets-quantity-trigger",function(){s.changeQuantity(this,"minus"!=t(this).data("type"))}),t(document).off("change",e.BUNDLES_WRAP+" "+e.QUANTITY_FLD).on("change",e.BUNDLES_WRAP+" "+e.QUANTITY_FLD,function(){s.onQuantityInputChange(t(this))}),t(document).off("click",e.BUNDLES_WRAP+" .js-productsets-product-skus").on("click",e.BUNDLES_WRAP+" .js-productsets-product-skus",function(){s.showSkusPopup(t(this))}),s.$set.on("closeSkus",e.POPUP,function(){t(this).remove(),s.$set.removeClass("p-loading"),s.xhrSkus&&s.xhrSkus.abort(),s.xhrSkus=!1})},s.prototype.onScroll=function(s,i,o){var n=s.not("."+e.FIXED+(o?"."+o:"")).offset(),r=s.outerHeight()+(o?20:0),a=i.height(),c=t(window).scrollTop()+this.extraParams.stickyTopOffset,d=n.top+a-r;if(c>=n.top&&c<d){if(!this.$set.find("."+e.FIXED+(o?"."+o:"")).length){var u=s.clone();s.addClass("vhidden"),u.width(s.outerWidth()),u.height(r),this.extraParams.stickyTopOffset&&u.css("top",this.extraParams.stickyTopOffset),u.css("left",s.offset().left),u.addClass(e.FIXED+(o?" "+o:"")),this.$set.append(u)}}else s.removeClass("vhidden"),this.$set.find("."+e.FIXED+(o?"."+o:"")).remove()},s.prototype.submitForm=function(e){var s=this;if(!e.is_locked){s.lockController(e);var n=new i(void 0!==e.validateParams?e.validateParams:s.validateParams),r=e.collectData();if(!n.validateSubmitData(r,e))return s.unlockController(e),setTimeout(function(){n.display(),e.reachGoal("submit_error")},10),!1;function a(t){for(var s in t.errors){var i=t.errors[s];n.addError(i)}n.display(),e.reachGoal("submit_error")}t.post(t.productsets.urls.buy,r).done(function(s){"ok"==s.status?function(s){var i=e.getType();let n=t('<svg class="static-popup-icon" '+("bundle"===i?t.productsets.options.attr.successPopupTickBundle:t.productsets.options.attr.successPopupTickUserBundle)+'><use xlink:href="'+t.productsets.PLUGIN_URL+'img/svg/checkmark.svg#check"></use></svg>'+__("Products has been successfully added to the cart")+'<div class="productsets-popup-buttons"><span data-productsets-close '+("bundle"===i?t.productsets.options.attr.successPopupLinkBundle:t.productsets.options.attr.successPopupLinkUserBundle)+">"+__("Continue shopping")+'</span><a class="productsets-button" '+("bundle"===i?t.productsets.options.attr.successPopupButtonBundle:t.productsets.options.attr.successPopupButtonUserBundle)+' href="'+t.productsets.urls.cartPage+'">'+__("Proceed to checkout")+"</a></div>");n.find("[data-productsets-close]").click(function(){t.productsets.closeUserbundlePopup(t(this))});let r={$set:e.$set,content:n,class:"static-popup is-success",fixed:!0,isSuccess:!0,type:i};new o(t.extend(r,void 0!==e.popupParams?e.popupParams:{})),e.reachGoal("submit")}():"fail"==s.status&&s.errors&&a(s)},"json").fail(function(t,e,s){a({errors:[__("Something wrong!")]}),console&&console.error(t,e,s)}).always(function(){s.unlockController(e)})}},s.prototype.lockController=function(t){var s=t.getSubmitBtn();t.is_locked=1,s.addClass(e.DISABLED),t.$set.addClass(e.LOCKED),s.find(e.BUTTON_LOADING).length||s.append(this.loading),t.reachGoal("locked")},s.prototype.unlockController=function(t){var s=t.getSubmitBtn();t.is_locked=0,t.$set.removeClass(e.LOCKED),s.removeClass(e.DISABLED).find(e.BUTTON_LOADING).remove(),t.reachGoal("unlocked")},s.prototype.reachGoal=function(t,e){this.$set.trigger("productsets-"+t,e)},s.prototype.showSkusPopup=function(s){var i=s.closest(e.ITEM),n=this.getActiveController(s);new o({$set:this.$set,title:__("Select product sku"),url:t.productsets.urls.getProductSkus,$activeElem:i,postData:{id:i.data("id"),ruble_sign:this.rubleSign,settings:i.data("settings"),type:n.$bundle.data("skus-popup")},extraData:[{name:"product",value:i},{name:"parent",value:i.closest(e.CONTROLLER).data("controller")},{name:"rubleSign",value:this.rubleSign}],type:n.getType()})},s.prototype.onQuantityInputChange=function(t){var e=t,s=parseFloat(e.val()),i=e.attr("data-min");void 0!==i&&parseFloat(i)>s&&e.val(i);var o=e.attr("data-max");void 0!==o&&parseFloat(o)<s&&e.val(o),(s<=0||isNaN(s))&&(s=i||1,e.val(s)),this.getActiveController(e).update()},s.prototype.getActiveController=function(t){return t.closest(e.CONTROLLER).data("controller")},s.prototype.changeQuantity=function(e,s){var i,o=t(e).siblings('input[type="text"]'),n=parseFloat(o.val()),r=o.data("step")||1;if(s){i=n+r;var a=o.attr("data-max");void 0!==a&&parseFloat(a)<i&&(i=parseFloat(a))}else{i=n-r;var c=o.attr("data-min");void 0!==c&&parseFloat(c)>i&&(i=parseFloat(c))}i<=0&&(i=o.data("min")||1),o.val(i).trigger("change")},s.prototype.update=function(t){this.$bundle=t||this.$set.find(e.ACTIVE_BUNDLE),this.type=this.getBundleType(),this.$bundle.length&&(this.initBundle(),this.updatePrices(),this.afterExecute())},s.prototype.getBundleType=function(){return this.$bundle.is(".productsets-bundle")?"bundle":"userbundle"},s.prototype.initBundle=function(){this.bundleSettings=this.$bundle.data("settings"),this.initVars(),"bundle"==this.type&&(this.resetItems(),this.collectItems())},s.prototype.collectItems=function(s){var i=this;(s=s||0)&&(i.items=[],i.bundleItems=[]),i.$bundle.find(e.BUNDLE_ITEM).not(".ps-ignore").each(function(){var e=i.getActiveItem(t(this));if(e.length)if(i.isInactive(e)){if(i.bundleItems.push(i.getData(e,!0)),!s&&void 0!==e.data("settings").discount_required)return i.collectItems(!0),i.resetDiscounts=!0,!1}else{var o=i.getData(e,s);i.items.push(o),i.bundleItems.push(o);var n=o.quantity*o.price;i.dirtyTotal+=n,i.totalComparePrice+=o.compare_price>0?o.quantity*o.compare_price:n}}),i.dirtyDiscount=i.totalComparePrice-i.dirtyTotal},s.prototype.initVars=function(){this.dirtyTotal=0,this.dirtyDiscount=0,this.commonDiscount=0,this.discount=0,this.total=0,this.totalComparePrice=0,this.activeController=this.$bundle.data("controller"),this.isChangePrices=this.activeController.$set.data("change-price"),this.discountRounding=this.activeController.$set.data("round")||"not",this.items="bundle"==this.type?[]:this.activeController.items,this.bundleItems=[],this.allItems={},this.resetDiscounts=!1},s.prototype.resetItems=function(){var s=this;s.resetDiscounts=!0,s.$bundle.find(e.BUNDLE_ITEM).each(function(){var e=s.getActiveItem(t(this));if(e.length&&!s.isInactive(e)){var i=s.getData(e,!0);s.items.push(i);var o=i.quantity*i.price;s.dirtyTotal+=o,s.totalComparePrice+=i.compare_price>0?i.quantity*i.compare_price:o}}),s.updatePrices(),s.initVars()},s.prototype.updateTotalValues=function(){this.dirtyTotal=this.totalComparePrice=this.dirtyDiscount=0;var t=this.getItems();for(var e in t){var s=t[e],i=s.quantity*s.price;this.dirtyTotal+=i,this.totalComparePrice+=s.compare_price>0?s.quantity*s.compare_price:i}this.dirtyTotal-=this.commonDiscount,this.dirtyTotal<0&&(this.dirtyTotal=0),this.dirtyDiscount=this.totalComparePrice-this.dirtyTotal},s.prototype.updatePrices=function(s){let i=this;s=s||0,i.updateDiscount(s),i.updateTotalPrice();let o=s?i.getAllItems():i.getItems();if(s||i.getItemsLength())for(let t in o){let e=o[t],s=e.obj;n(s,e),r(s,e),a(s,e)}function n(s,o){let n=i.isChangePrices?o.price:o.original_price;s.find(e.PRICE_FLD).data("price",o.price).data("original-price",o.original_price).attr("data-price",o.price).attr("data-original-price",o.original_price).html(t.productsets.currencyFormat(n,i.rubleSign))}function r(s,o){let n=s.find(e.COMPARE_PRICE_FLD),r=i.isChangePrices?o.price:o.original_price,a=i.isChangePrices?o.compare_price:o.original_compare_price;n.data("price",o.compare_price).data("original-price",o.original_compare_price).attr("data-price",o.compare_price).attr("data-original-price",o.original_compare_price).html(t.productsets.currencyFormat(a,i.rubleSign)),a>0&&a>r?n.addClass("ps-show-compare-price").show():n.removeClass("ps-show-compare-price").hide()}function a(t,s){let o=i.calculateBadgeDiscount(s);t.find(e.BADGE).text("- "+o+"%"),o>0?t.find(e.BADGE_FLD).show():t.find(e.BADGE_FLD).hide()}i.resetPricesVars()},s.prototype.resetPricesVars=function(){this.dirtyTotal=0,this.dirtyDiscount=0,this.commonDiscount=0,this.discount=0,this.total=0,this.totalComparePrice=0},s.prototype.updateTotalPrice=function(){let e=this.getTotal(),s=this.getComparePrice();e>=s&&(s=0),this.activeController.getTotalPriceFld().html(t.productsets.currencyFormat(e,this.rubleSign)),this.activeController.getTotalComparePriceFld().html(s?t.productsets.currencyFormat(s,this.rubleSign):"")},s.prototype.updateDiscount=function(e){let s=this.getDiscount(e),i=this.activeController.getDiscountFld(),o=this.activeController.getDiscountFldWrap();i.html(t.productsets.currencyFormat(s,this.rubleSign)),s<=0?o.addClass("vhidden"):o.removeClass("vhidden")},s.prototype.afterExecute=function(){"function"==typeof this.activeController.afterUpdate&&this.activeController.afterUpdate()},s.prototype.calculateBadgeDiscount=function(t){let e=0;const s=this.isChangePrices?t.price:t.original_price,i=this.isChangePrices?t.compare_price:t.original_compare_price;return i>0&&(e=100*(1-s/i))>0&&(e=e>99&&e<100||e<1?e.toFixed(2):e.toFixed()),e},s.prototype.getTotal=function(){return this.total=this.dirtyTotal,this.total},s.prototype.getItems=function(){return this.items},s.prototype.getBundleItems=function(){return this.bundleItems},s.prototype.getItemsLength=function(){return Object.keys(this.items).length},s.prototype.getDiscount=function(t){return this.resetDiscounts||("common"==this.bundleSettings.discount_type&&"%"!==this.bundleSettings.currency&&this.bundleSettings.frontend_discount>0&&(this.commonDiscount+=parseFloat(this.bundleSettings.frontend_discount)),"avail"==this.bundleSettings.discount_type&&this.getAvailDiscount(t)),this.commonDiscount=this.round(this.commonDiscount),this.updateTotalValues(),this.discount+=this.dirtyDiscount,this.discount},s.prototype.getComparePrice=function(){return this.totalComparePrice},s.prototype.getData=function(t,s,i){var o=t.data("settings"),n={sku_id:t.data("sku-id"),obj:t,settings:o};s=s||0,i=i||this.bundleSettings;var r=o.quantity||1;if(o.choose_quantity){var a=t.find(e.QUANTITY_FLD);r=a.val(),void 0!==a.data("max")&&a.data("max")&&r>parseFloat(a.data("max"))&&(r=parseFloat(a.data("max")))}n.quantity=parseFloat(r);var c=t.find(e.PRICE_FLD);n.original_price=parseFloat(c.attr("data-original-price")),n.price=s?n.original_price:parseFloat(c.attr("data-price"));var d=t.find(e.COMPARE_PRICE_FLD);return n.original_compare_price=parseFloat(d.attr("data-original-price")),n.compare_price=s?n.original_compare_price:parseFloat(d.attr("data-price")),n.discount=s?0:this.getItemDiscount(n.original_price,o,i),n.discount>0&&n.price===n.original_price&&(n.compare_price<=0&&(n.compare_price=n.price),n.price=n.original_price-n.discount,n.price<0&&(n.price=0,n.discount=n.original_price)),n},s.prototype.getItemDiscount=function(t,e,s){return"common"==s.discount_type&&"%"==s.currency?this.getCommonDiscount(t,s.frontend_discount,s.currency):"each"==s.discount_type?this.getCommonDiscount(t,e.frontend_discount,e.currency):0},s.prototype.getCommonDiscount=function(t,e,s){return"%"===s?this.round(t*e/100):this.round(e)},s.prototype.round=function(t){const e=function(t,e,s){return void 0===s||0==+s?Math[t](e):(e=+e,s=+s,isNaN(e)||"number"!=typeof s||s%1!=0?NaN:(e=e.toString().split("e"),+((e=(e=Math[t](+(e[0]+"e"+(e[1]?+e[1]-s:-s)))).toString().split("e"))[0]+"e"+(e[1]?+e[1]+s:s))))};switch(this.discountRounding){case"ceil":return Math.ceil(t);case"floor":return Math.floor(t);case"round":return Math.round(t);case"tens":return e(t,1);case"hund":return e(t,2);case"dec1":return e(t,-1);case"dec2":return e(t,-2);default:return t}},s.prototype.getAvailDiscount=function(t){"every"==this.bundleSettings.avail_discount_type?this.getAvailEveryDiscount():this.getAvailCommonDiscount(t)},s.prototype.getAvailCommonDiscount=function(t){var e=(t=t||0)?this.getAllItems():this.getItems(),s=this.getItemsLength()-1;if(-1!==s){let i=this.setAvailCommonChainDiscount(s,e,t);i.discountValue>0&&!i.discountEach&&"%"!==i.discountCurrency&&(this.commonDiscount+=i.discountValue,t&&this.setAvailCommonChainDiscount(this.getLastPercantageChainValue(s),e,t))}else t&&this.changeAllPrices()},s.prototype.getLastPercantageChainValue=function(t){var e=t;if(-1!==e&&void 0!==this.bundleSettings.chain&&void 0!==this.bundleSettings.chain.value&&this.bundleSettings.chain.value.length)for(let t=e-1;t>=0;t--){let e=this.getAvailDiscountCurrency(t),s=this.getAvailDiscountEach(t);if("%"==e||s)return t}return-1},s.prototype.setAvailCommonChainDiscount=function(e,s,i){var o=this,n=0,r=0,a=0,c=e;if(-1!==c&&void 0!==o.bundleSettings.chain&&void 0!==o.bundleSettings.chain.value&&o.bundleSettings.chain.value.length){var d=o.bundleSettings.chain.value.length-1;c>d&&(c=d),n=o.getAvailDiscountValue(c),r=o.getAvailDiscountCurrency(c),a=o.getAvailDiscountEach(c),(n>0||i)&&("%"==r||a)&&t.each(s,function(t,e){var s="%"==r?n*e.original_price/100:n;s=o.round(s),o.changePrices(t,s,i)})}return{discountValue:n,discountCurrency:r,discountEach:a}},s.prototype.getAvailDiscountValue=function(t){return parseFloat(void 0!==this.bundleSettings.chain.frontend_value&&this.bundleSettings.chain.frontend_value[t]?this.bundleSettings.chain.frontend_value[t]:0)},s.prototype.getAvailDiscountCurrency=function(t){return void 0!==this.bundleSettings.chain.currency&&this.bundleSettings.chain.currency[t]?this.bundleSettings.chain.currency[t]:0},s.prototype.getAvailDiscountEach=function(t){return parseInt(void 0!==this.bundleSettings.chain.each&&this.bundleSettings.chain.each[t]?this.bundleSettings.chain.each[t]:0)},s.prototype.getAllItems=function(){var s=this;return Object.keys(s.allItems).length||s.$bundle.find(e.ITEM).each(function(){var e=s.getData(t(this));s.allItems["i"+e.sku_id]=e}),s.allItems},s.prototype.changePrices=function(t,e,s){var i=s?this.allItems[t]:this.items[t];(e>0||s)&&void 0!==i&&(i.compare_price=i.original_compare_price>0?i.original_compare_price:i.original_price,i.price=i.original_price-e,i.price<0&&(i.price=0,i.discount=i.original_price),i.compare_price===i.price&&(i.compare_price=0),s?this.allItems[t]=i:this.items[t]=i)},s.prototype.changeAllPrices=function(e){var s=this;e=e||0,e=s.round(e);var i=s.getAllItems();t.each(i,function(t){s.changePrices(t,e,1)})},s.prototype.getAvailEveryDiscount=function(){var t=this.getItems();for(var e in t){var s=t[e],i=this.getAvailDiscountValue(e),o=this.getAvailDiscountCurrency(e);if(i>0){var n="%"==o?i*s.original_price/100:i;this.changePrices(e,n)}}},s.prototype.isItemHasAlternative=function(t){return t.is(e.ALTERNATIVE_ITEM)},s.prototype.isInactive=function(t){return t.hasClass(e.INACTIVE)||t.hasClass(e.DELETED)},s.prototype.getActiveItem=function(t){if(this.isItemHasAlternative(t)){var s=t.find(e.ACTIVE_ALTERNATIVE_ITEM);return s.length||void 0===t.data("active-slide")||(s=t.find(e.SLIDE).eq(t.data("active-slide")).find(e.ITEM)),s}return t.find(">"+e.ITEM)},s.prototype.lock=function(){this.$set.addClass(e.LOADING)},s.prototype.unlock=function(){this.$set.removeClass(e.LOADING)},s),i=(jQuery,(i=function(t){this.errors=[],this.$set=t.$set,this.$errorBlock=this.$set.find(e.ERROR_BLOCK),this.options=t,this.initClass()}).prototype={initClass:function(){this.reset()},reset:function(){this.$errorBlock.html("").hide(),this.$set.find(e.POPUP).remove()},addError:function(t){this.errors.push(t)},display:function(){if(this.errors.length){var e=[];for(var s in this.errors)e.push(this.errors[s]);e.length&&(this.options.popupErrors?new o({$set:this.$set,content:'<svg class="static-popup-icon"><use xlink:href="'+t.productsets.PLUGIN_URL+'img/svg/cross.svg#cross"></use></svg>'+e.join("<br>"),class:"static-popup is-error",fixed:!0}):this.$errorBlock.html(e.join("<br>")).show())}},validateSubmitData:function(t,e){if(!t.items.length)return this.addError(__("The set is empty")),!1;if("userbundle"===t.type&&void 0!==e.bundleSettings.min){let s=parseFloat(e.bundleSettings.min);if(t.items.length<s)return this.addError(__("Minimal quantity of products is")+" "+s),!1}if("userbundle"===t.type&&void 0!==e.bundleSettings.max){let s=parseFloat(e.bundleSettings.max);if(t.items.length>s)return this.addError(__("Maximal quantity of products is")+" "+s),!1}return!0}},i),o=(jQuery,(o=function(t){this.$set=t.$set,this.$popup="",this.options=t,this.xhrSkus=!1,this.loaded=0,this.initClass(),this.bindEvents()}).prototype={initClass:function(){var s,i=this;i.options.inited=1,i.close(),i.options.url?s=i.loadByUrl():(s=t.Deferred().resolve(),i.show()),i.options.inited=0,s.done(function(){i.$popup.removeClass(e.LOADING),i.options.freezeBody&&t("body").addClass("productsets-popup-opened")})},bindEvents:function(){var t=this;t.$popup.find("[data-productsets-close]").click(function(){t.close()})},loadByUrl:function(){var e=this;return e.show(),e.xhrSkus=t.post(e.options.url,e.options.postData,function(t){e.show(t)}),e.xhrSkus},show:function(s){if(!this.$popup.length){var i='    <div class="productsets-popup is-loading" '+this.getAppearanceAttr("block")+'>        <div class="productsets-popup-head" '+this.getAppearanceAttr("head")+">"+(this.options.title?this.options.title:"")+"           <span data-productsets-close "+this.getAppearanceAttr("close")+'></span>        </div>        <div class="productsets-popup-content" '+this.getAppearanceAttr("content")+'>            <span class="productsets-loading2"></span>        </div>    </div>';this.$popup=t(i),this.options.class&&this.$popup.addClass(this.options.class),this.$set.addClass("p-loading").append(this.$popup),this.bindEvents(),this.addExtraData(),this.$popup.data("controller",this)}s?this.$popup.find(e.POPUP_CONTENT).html(s):this.options.content&&this.$popup.find(e.POPUP_CONTENT).html(this.options.content),this.position()},getAppearanceAttr:function(e){var s="";if(void 0!==this.options.type)switch(e){case"block":s="bundle"===this.options.type?this.options.isSuccess?"successPopupBundleBlock":"skusPopupBundleBlock":this.options.isSuccess?"successPopupUserBundleBlock":"skusPopupUserBundleBlock";break;case"head":s="bundle"===this.options.type?this.options.isSuccess?"":"skusPopupBundleHeader":this.options.isSuccess?"":"skusPopupUserBundleHeader";break;case"close":s="bundle"===this.options.type?this.options.isSuccess?"successPopupCloseBundle":"skusPopupBundleClose":this.options.isSuccess?"successPopupCloseUserBundle":"skusPopupUserBundleClose";break;case"content":s="bundle"===this.options.type?this.options.isSuccess?"successPopupContentBundle":"skusPopupBundleContent":this.options.isSuccess?"successPopupContentUserBundle":"skusPopupUserBundleContent"}return void 0!==t.productsets.options.attr[s]?t.productsets.options.attr[s]:""},addExtraData:function(){var e=this;e.$popup.data("controller",e),e.options.extraData&&t.each(e.options.extraData,function(t,s){e.$popup.data(s.name,s.value)})},position:function(){var t={top:"50px"};this.options.$activeElem&&(t.top=this.options.$activeElem.offset().top-this.$set.offset().top),this.options.fixed&&(delete t.top,this.$popup.addClass("productsets-popup-fixed"),t["margin-top"]=this.$popup.outerHeight()/2*-1),t["margin-left"]=-1*Math.max(0,this.$popup.outerWidth()/2)+"px",this.$popup.css(t)},close:function(){this.$set.find(e.POPUP).remove(),this.$set.removeClass("p-loading"),this.xhrSkus&&this.xhrSkus.abort(),this.xhrSkus=!1,this.options.freezeBody&&t("body").removeClass("productsets-popup-opened"),this.options.isSuccess&&this.$set.data("reload")&&!this.options.inited&&location.reload()}},o),n=((n=function(t){this.$bundle=t,this.$set=this.$bundle.closest(e.SET),this.setController=this.$set.data("controller"),this.is_locked=0,this.$bundle.data("controller",this),this.initClass(),this.bindEvents()}).prototype.initClass=function(){this.initSliders(),this.$bundle.removeClass("not-inited")},n.prototype.getType=function(){return"bundle"},n.prototype.bindEvents=function(){var s=this;t(document).off("click",e.TOTAL_ITEM_DELETE).on("click",e.TOTAL_ITEM_DELETE,function(){const s=t(this).closest(e.TOTAL_ITEM),i=s.data("index"),o=s.closest(e.SET).data("controller").getBundleItems();o.length&&void 0!==o[i]&&o[i].obj.find(e.ITEM_STATUS_CHECKBOX).prop("checked",!!o[i].obj.hasClass(e.DELETED)).change()}),t(document).off("click",".js-productsets-show-alternative").on("click",".js-productsets-show-alternative",function(){const i=t(this).closest(e.BUNDLE_ITEM);let n=i.find(e.ALTERNATIVE_BLOCK).html(),r={$set:i.closest(e.SET),content:n,class:"alternative-popup",fixed:!0,type:s.getType(),freezeBody:!0,title:__("Select another product"),extraData:[{name:"product",value:i}]};setTimeout(function(){new o(r)},50)}),t(document).off("click",".js-select-alternative-item").on("click",".js-select-alternative-item",function(){const i=t(this),o=i.closest(e.POPUP),n=o.data("product");if(n){const t=n.find(e.ITEM).clone(),s=i.find(e.ITEM);n.find(">"+e.ITEM).remove(),n.prepend(i.html()),n.attr("data-id",s.attr("data-id")).attr("data-sku-id",s.attr("data-sku-id")),t.find(".productsets-item-image").removeAttr("style"),n.find(".productsets-alternative "+e.ITEM+'[data-id="'+s.attr("data-id")+'"][data-sku-id="'+s.attr("data-sku-id")+'"]').replaceWith(t.prop("outerHTML"))}o.data("controller").close(),s.setController.update(n.closest(e.CONTROLLER))}),t(document).off("click",".js-select-alternative-item .productsets-item-link").on("click",".js-select-alternative-item .productsets-item-link",function(t){t.preventDefault()}),t(document).off("change",e.ITEM_STATUS_CHECKBOX).on("change",e.ITEM_STATUS_CHECKBOX,function(){var i=t(this),o=i.closest(e.ITEM);i.prop("checked")?o.removeClass("item-deleted"):o.addClass("item-deleted"),s.setController.update(o.closest(e.CONTROLLER))}),s.$set.hasClass("ps-sticky")&&"top"===s.$set.find(e.TOTAL_WRAP).data("position")&&t(window).scroll(function(){var t=s.$set.data("controller");void 0!==t&&t.onScroll(s.$set.find(e.TOTAL_WRAP),s.$set.find(e.BUNDLE_WRAP))})},n.prototype.collectData=function(){var e={set_id:this.$set.data("id"),bundle_id:this.$bundle.data("bundle-id"),include_product:this.$bundle.data("include-product"),items:[]},s=this.$set.data("controller");if(void 0!==s){this.update();var i=s.getItems();t.each(i,function(t,s){e.items.push({sku_id:s.sku_id,quantity:s.quantity,_id:s.settings._id})})}return e},n.prototype.update=function(){var t=this.$set.data("controller");void 0!==t&&t.update(this.$bundle)},n.prototype.reachGoal=function(t){var e=this.$set.data("controller");void 0!==e&&e.reachGoal(t,[this.$bundle])},n.prototype.initSliders=function(){var s=this;s.$bundle.find(".js-productsets-init-alt-slider").each(function(){const i=t(this),o=i.data("slider-type")||"vertical",n={vertical:!0,slidesToShow:1,slidesToScroll:1,infinite:!1,prevArrow:'<div class="productsets-alt-prev"><svg viewBox="0 0 32.2 20.3" class="productsets-icon atop" '+t.productsets.options.attr.sliderArrow+'><use xlink:href="'+t.productsets.PLUGIN_URL+'img/svg/arrows.svg#arrow-up"></use></svg></div></div>',nextArrow:'<div class="productsets-alt-next"><svg viewBox="0 0 32.2 20.3" class="productsets-icon adown" '+t.productsets.options.attr.sliderArrow+'>    <use xlink:href="'+t.productsets.PLUGIN_URL+'img/svg/arrows.svg#arrow-down"></use>  </svg></div>',appendArrows:i,draggable:!1,lazyLoad:"ondemand",adaptiveHeight:!0,cssEase:"linear"};"horizontal"===o&&(n.vertical=!1,n.prevArrow='<div class="productsets-alt-prev"><svg viewBox="0 0 32.2 20.3" class="productsets-icon aleft" '+t.productsets.options.attr.sliderArrow+'><use xlink:href="'+t.productsets.PLUGIN_URL+'img/svg/arrows.svg#arrow-left"></use></svg></div></div>',n.nextArrow='<div class="productsets-alt-next"><svg viewBox="0 0 32.2 20.3" class="productsets-icon aright" '+t.productsets.options.attr.sliderArrow+'>    <use xlink:href="'+t.productsets.PLUGIN_URL+'img/svg/arrows.svg#arrow-right"></use>  </svg></div>'),i.on("init afterChange",function(t,o,n){i.data("active-slide",n),s.update(),s.$set.find(e.BUNDLES_WRAP).productsetsSlick("setPosition")}).productsetsSlick(n)})},n.prototype.afterUpdate=function(){this.$bundle.find(".js-productsets-init-alt-slider").trigger("resize"),this.updateTotalBlockItems()},n.prototype.updateTotalBlockItems=function(){const s=this,i=s.$bundle.find(e.TOTAL_ITEMS);if(i.length){let o="";const n=s.$set.data("controller");if(void 0!==n){let e=n.getBundleItems(),r=0;t.each(e,function(t,e){o+=s.addItemToTotalBlock(e,t,n),e.settings.delete_product&&(r=1)}),r?i.removeClass("hide-delete"):i.addClass("hide-delete")}i.html(o),s.$set.find(e.BUNDLES_WRAP).productsetsSlick("setPosition")}},n.prototype.addItemToTotalBlock=function(s,i,o){let n='<div class="productsets-total-item'+(s.obj.hasClass(e.DELETED)?" psi-deleted":"")+'" data-index="'+i+'"><div class="pti-name"><span class="pti-title">'+s.obj.find(e.ITEM_NAME).text()+"</span>"+(s.obj.find(e.ITEM_SKU).length?' <span class="pti-sku">('+s.obj.find(e.ITEM_SKU).text()+")</span>":"")+'</div><div class="pti-price">'+t.productsets.currencyFormat(s.price,o.rubleSign)+'</div><div class="pti-quantity">x '+s.quantity+"</div>";return s.settings.delete_product?n+='<div class="pti-icon" title="'+__("delete")+'"><svg viewBox="0 0 32 32"><use xlink:href="'+t.productsets.PLUGIN_URL+'img/svg/cross.svg#cross"></use></svg></div>':n+='<div class="pti-icon empty-delete-block"></div>',n+="</div>"},n.prototype.getDiscountFld=function(){return this.$set.find(e.TOTAL_DISCOUNT)},n.prototype.getDiscountFldWrap=function(){return this.$set.find(e.TOTAL_DISCOUNT_WRAP)},n.prototype.getTotalPriceFld=function(){return this.$set.find(e.TOTAL_PRICE)},n.prototype.getTotalComparePriceFld=function(){return this.$set.find(e.TOTAL_WRAP).find(e.TOTAL_COMPARE_PRICE)},n.prototype.getSubmitBtn=function(){return this.$set.find(e.BUY_BUTTON)},n),r=((r=function(s){this.$bundle=s,this.$set=this.$bundle.closest(e.SET),this.$visibleItems=this.$bundle.find(e.ITEM),this.$totalDiscountWrap=this.$bundle.find(e.USERBUNDLE_TOTAL_DISCOUNT_WRAP),this.$totalDiscount=this.$bundle.find(e.USERBUNDLE_TOTAL_DISCOUNT),this.$add2cart=this.$bundle.find(e.USERBUNDLE_INFO),this.$loader=this.$bundle.find(e.BUTTON_LOADING),this.$thumbs=this.$bundle.find(e.USERBUNDLE_THUMBS),this.setController=this.$set.data("controller"),this.is_locked=0,this.on_init=1,this.popupParams={$activeElem:this.getSubmitBtn()},this.items={},this.groups={},this.itemsQty=0,this.bundleSettings=this.$bundle.data("settings"),this.imageMinEmpty='<svg viewBox="0 0 468.069 468.069"><use xlink:href="'+t.productsets.PLUGIN_URL+'img/svg/square.svg#square"></use></svg>',this.$bundle.data("controller",this),this.initClass(),this.bindEvents()}).prototype.initClass=function(){this.initGroups(),this.update(),this.$bundle.removeClass("not-inited"),this.$add2cart.show(),this.$loader.hide(),this.on_init=0},r.prototype.initGroups=function(){var s=this;s.$bundle.find(e.USERBUNDLE_GROUP).each(function(){let e=t(this);s.groups[e.data("id")]={obj:e,settings:e.data("settings")}})},r.prototype.collectData=function(){var e={set_id:this.$set.data("id"),type:this.getType(),include_product:this.$bundle.data("include-product"),items:[]},s=this.getItems();return t.each(s,function(t,s){e.items.push({sku_id:s.sku_id,quantity:s.quantity,_id:s.settings._id})}),e},r.prototype.reachGoal=function(t){void 0!==this.setController&&this.setController.reachGoal(t,[this.$bundle])},r.prototype.getType=function(){return"userbundle"},r.prototype.update=function(){this.updateItems(),this.setController.update(this.$bundle)},r.prototype.afterUpdate=function(){var t=this.getTotalQty();this.$set.find(e.USERBUNDLE_TOTAL_QUANTITY).text(__("1 product","{n} products",t,{n:t})),this.bundleSettings.show_thumbs&&this.updateThumbs(),"each"==this.bundleSettings.discount_type?(this.calculateGroupDiscount(),this.setController.updatePrices()):"avail"==this.bundleSettings.discount_type&&this.setController.updatePrices(!0)},r.prototype.calculateGroupDiscount=function(){var e=this;let s={},i=0;t.each(e.getItems(),function(t,o){if(void 0!==o.additional&&void 0!==o.additional.group_id&&void 0!==e.groups[o.additional.group_id]){let t=e.groups[o.additional.group_id].settings;if("common"==t.discount_type&&"%"!==t.currency){void 0===s[o.additional.group_id]&&(s[o.additional.group_id]=parseFloat(t.frontend_discount));let e=0;o.price*o.quantity<s[o.additional.group_id]?(e=o.price*o.quantity,s[o.additional.group_id]-=e):(e=s[o.additional.group_id],s[o.additional.group_id]=0),i+=parseFloat(e)}}}),i&&(e.setController.commonDiscount+=i)},r.prototype.updateItems=function(){let t=this.getItems();this.itemsQty=0,this.items={};for(let s in t){var e=t[s];t[s].obj.length&&(e=this.setController.getData(t[s].obj,0,this.bundleSettings),void 0!==t[s].additional&&(e.additional=t[s].additional),this.items["i"+e.sku_id]=e),this.itemsQty+=e.quantity}this.saveItems()},r.prototype.saveItems=function(){this.$bundle.data("items",this.items)},r.prototype.getItems=function(){var s=this;if(s.on_init)s.$visibleItems.filter(e.SELECTED_USERITEM).each(function(){s.addItem(t(this))});else if(s.$bundle.data("items"))return s.$bundle.data("items");return s.items},r.prototype.getItemsLength=function(){return Object.keys(this.items).length},r.prototype.addItem=function(t,e){var s=this.setController.getData(t,0,this.bundleSettings);e&&e.length&&(s.additional={group_id:e.data("id")}),this.items["i"+s.sku_id]=s,this.saveItems()},r.prototype.removeItem=function(t){void 0!==this.items["i"+t.data("sku-id")]&&delete this.items["i"+t.data("sku-id")],this.saveItems()},r.prototype.updateThumbs=function(){let t=this.getItems();this.$thumbs.html("");for(let s in t){let i=t[s].obj.find(e.ITEM_IMAGE),o=i.find("img").clone();o.attr("src",i.attr("data-src")),this.$thumbs.append(o)}if(void 0!==this.bundleSettings.min){let t=parseFloat(this.bundleSettings.min),e=this.getItemsLength();if(e<t)for(var s=0;s<t-e;s++)this.$thumbs.append(this.imageMinEmpty)}},r.prototype.getTotalQty=function(){return this.itemsQty},r.prototype.addItemToBundle=function(s){var i=this;let o=s.closest(e.USERBUNDLE_GROUP);i.addItem(s,o);let n=s.addClass("added").find(e.USERBUNDLE_ADD2CART_ITEM);if(s.find(e.USERBUNDLE_ADD2CART_ITEM_TEXT).text(n.data("added")),o.data("multiple")||(s.siblings(e.SELECTED_USERITEM).each(function(){i.removeItemFromBundle(t(this))}),o.addClass(e.ONE_VARIANT)),void 0!==i.bundleSettings.max){let t=parseFloat(i.bundleSettings.max);i.getItemsLength()>=t&&i.hideAdd2BundleButtons()}},r.prototype.removeItemFromBundle=function(t){this.removeItem(t);let s=t.removeClass("added").find(e.USERBUNDLE_ADD2CART_ITEM);t.find(e.USERBUNDLE_ADD2CART_ITEM_TEXT).text(s.data("add"));let i=void 0!==this.bundleSettings.max&&""!==this.bundleSettings.max?parseFloat(this.bundleSettings.max):999999;this.getItemsLength()<i?this.showAdd2BundleButtons():this.hideAdd2BundleButtons();let o=t.closest(e.USERBUNDLE_GROUP);o.data("multiple")||t.siblings(e.SELECTED_USERITEM).length||o.removeClass(e.ONE_VARIANT)},r.prototype.hideAdd2BundleButtons=function(s){function i(t){(t.data("multiple")||!t.data("multiple")&&!t.find(e.SELECTED_USERITEM).length)&&t.find(e.ITEM).not(e.SELECTED_USERITEM).find(e.USERBUNDLE_ADD2CART_ITEM).css("visibility","hidden")}s?i(t(this)):this.$bundle.find(e.USERBUNDLE_GROUP).each(function(){i(t(this))})},r.prototype.showAdd2BundleButtons=function(s){function i(t){t.find(e.USERBUNDLE_ADD2CART_ITEM).css("visibility","visible")}s?i(s):this.$bundle.find(e.USERBUNDLE_GROUP).each(function(){i(t(this))})},r.prototype.bindEvents=function(){var s=this;s.$bundle.off("click",e.USERBUNDLE_BUY_BUTTON).on("click",e.USERBUNDLE_BUY_BUTTON,function(){s.setController.submitForm(s)}),t(document).off("click",e.USERBUNDLE_BUY_BUTTON).on("click",e.USERBUNDLE_BUY_BUTTON,function(){s.setController.submitForm(s)}),s.$set.find(e.USERBUNDLE_WRAP+" .js-productsets-quantity-trigger").click(function(){s.setController.changeQuantity(this,"minus"!=t(this).data("type"))}),s.$set.find(e.USERBUNDLE_WRAP+" "+e.QUANTITY_FLD).change(function(){s.setController.onQuantityInputChange(t(this))}),s.$set.find(e.USERBUNDLE_WRAP+" .js-productsets-product-skus").click(function(){s.setController.showSkusPopup(t(this))}),s.$bundle.find(".js-productsets-userbundle-add").click(function(){let i=t(this).closest(e.ITEM);return i.is(".added")?s.removeItemFromBundle(i):s.addItemToBundle(i),s.update(),!1}),s.$set.hasClass("ps-sticky")&&(t(".ig-dialog-wrap.productsets-dialog-wrapper .w-dialog-wrapper").scroll(function(){s.onScroll(t(this))}),t(window).scroll(function(){void 0!==s.setController&&s.setController.onScroll(s.$bundle.find(e.USERBUNDLE_TOTAL_WRAP),s.$bundle.find(e.USERBUNDLE_BODY),"fixed-userbundle")}))},r.prototype.onScroll=function(s){var i=this.$bundle.find(e.USERBUNDLE_TOTAL_WRAP).not(".ps-fixed.fixed-userbundle"),o=i.offset(),n=s.find(".productsets-dialog"),r=i.outerHeight()+20;if(t(window).scrollTop()>=o.top){if(!this.$bundle.find(".ps-fixed.fixed-userbundle").length){var a=i.clone();a.width(n.outerWidth()),a.height(r),a.css("left",n.offset().left),a.addClass("ps-fixed fixed-userbundle"),this.$bundle.append(a)}}else this.$bundle.find(".ps-fixed.fixed-userbundle").remove()},r.prototype.getDiscountFld=function(){return this.$totalDiscount},r.prototype.getDiscountFldWrap=function(){return this.$totalDiscountWrap},r.prototype.getTotalPriceFld=function(){return this.$set.find(e.USERBUNDLE_TOTAL_PRICE)},r.prototype.getTotalComparePriceFld=function(){return this.$set.find(e.TOTAL_COMPARE_PRICE)},r.prototype.getSubmitBtn=function(){return this.$set.find(e.USERBUNDLE_BUY_BUTTON)},r)}(jQuery);