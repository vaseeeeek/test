<script src="{$plugin_url}js/condition.js?v={$wa->version()}"></script>
{* Switcher *}
<link rel="stylesheet" href="{$wa_url}wa-content/js/jquery-plugins/ibutton/jquery.ibutton.min.css">
<script src="{$wa_url}wa-content/js/jquery-plugins/ibutton/jquery.ibutton.min.js"></script>

{* Chosen *}
<link rel="stylesheet" href="{$plugin_url}js/chosen/chosen.min.css">
<script src="{$plugin_url}js/chosen/chosen.jquery.min.js"></script>

{* Datepicker *}
<link rel="stylesheet" href="{$plugin_url}js/datepicker/css/metallic.css">
<script src="{$plugin_url}js/datepicker/javascript/zebra_datepicker.src.js"></script>

{* ColorPicker *}
<link rel="stylesheet" media="screen" href="{$plugin_url}/js/colorpicker/css/colorpicker.css" />
<script src="{$plugin_url}/js/colorpicker/js/colorpicker.js"></script>

{* Fileupload *}
<script src="{$plugin_url}/js/jquery-fileupload/js/vendor/jquery.ui.widget.js"></script>
<script src="{$plugin_url}/js/jquery-fileupload/js/jquery.iframe-transport.js"></script>
<script src="{$plugin_url}/js/jquery-fileupload/js/jquery.fileupload.js"></script>
<script src="{$plugin_url}/js/jquery-fileupload/js/jquery.fileupload-process.js"></script>
<script src="{$plugin_url}/js/jquery-fileupload/js/jquery.fileupload-validate.js"></script>

{* Dragsort *}
<script src="{$plugin_url}/js/jquery.dragsort-0.5.2.min.js"></script>

<link href="https://fonts.googleapis.com/css?family=Lobster|Lora|Noto+Sans|Open+Sans|Open+Sans+Condensed:300|PT+Sans|Roboto|Roboto+Condensed|Roboto+Slab|Ubuntu" rel="stylesheet">
<style>
    .condition-block.show-cond-op > .conditions:before { content: '{_wp("AND")}'; }
    .condition-block.show-cond-op.s-or > .conditions:before { content: '{_wp("OR")}'; }
    .chosen-container .chosen-results li.active-result { position: relative; }
    .chosen-container .chosen-results li.default-new:before { content: ''; position: absolute; right: 2px; top: 5px; width: 16px; height: 16px; background-image: url({$wa_app_static_url}img/ss-icon16.png?1607); background-position: 0 -32px; background-repeat: no-repeat;}
    .chosen-container .chosen-results li.default-bestseller:before { content: ''; position: absolute; right: 2px; top: 5px; width: 16px; height: 16px; background-image: url({$wa_app_static_url}img/ss-icon16.png?1607); background-position: -48px -112px; background-repeat: no-repeat;}
    .chosen-container .chosen-results li.default-lowprice:before { content: ''; position: absolute; right: 2px; top: 5px; width: 16px; height: 16px; background-image: url({$wa_app_static_url}img/ss-icon16.png?1607); background-position: -64px -112px; background-repeat: no-repeat;}
    .chosen-container .chosen-results li.s-create { padding-left: 20px; }
    .chosen-container .chosen-results li.s-create:before { content: ''; position: absolute; left: 0; top: 3px; width: 16px; height: 16px; background-image: url({$wa_static_url}wa-content/img/icon16.png?1503); background-position: -64px -16px; background-repeat: no-repeat;}
</style>

<h2 class="relative">
    <a class="back" href="#/autobadge/" title="[`Back`]">‚Üê [`Back`]</a>
    {if !empty($filter.name)}{$filter.name|escape}{else}[`No name rule`]{/if}
    {if !empty($filter)}
        <a href="#/filter/delete/{$filter.id}" class="js-action delete" title="[`Delete filter`]"><i class="icon16 delete"></i> [`delete`]</a>
    {/if}
</h2>
<form action="?plugin=autobadge&module=filter&action=save" method="post" id="autobadge-save-form">
    <div class="fields form">
        <div class="field-group">
            <div class="field">
                <div class="name">[`Status`]</div>
                <div class="value no-shift s-ibutton-checkbox">
                    <ul class="menu-h">
                        <li><span class="gray switcher-off">[`Disabled`]</span></li>
                        <li>
                            <input type="checkbox" class="switcher f-save-me" name="data[status]" value="1"{if !empty($filter.status) || !isset($filter.status)} checked{/if} />
                        </li>
                        <li><span class="switcher-on">[`Enabled`]</span></li>
                    </ul>
                </div>
            </div>
            <div class="field">
                <div class="name">[`Name`]</div>
                <div class="value"><input type="text" name="data[name]" class="f-save-me" {if !empty($filter.name)}value="{$filter.name|escape}"{/if}/></div>
            </div>
            <div class="field s-conditions">
                <div class="name">[`Conditions`]</div>
                <div class="value">
                    <div class="margin-block large">[`IF`]</div>
                    <div class="condition-block">
                        <div class="conditions">
                            <!-- Autogenerated content -->
                            <div class="align-center is-loading">[`Wait, please...`] <i class="icon16 loading"></i></div>
                        </div>
                        <a href="#/show/condition/" class="js-action" title="[`Add condition`]"><i class="icon16 add"></i> [`Add condition`]</a>
                    </div>
                    <input type="hidden" id="condition-input" class="f-save-me" name="data[conditions]" value="{if !empty($filter.conditions)}{$filter.conditions|escape}{/if}" />
                    <div class="margin-block large">[`Then add badges`]</div>

                    <input type="hidden" id="target-input" class="f-save-me" name="data[target]" value="{if !empty($filter.target)}{$filter.target|escape}{/if}" />
                    {* Target *}
                    <div class="targets">
                        <div class="live-preview empty" style="width: {if !empty($filter.preview_width)}{$filter.preview_width|escape}{else}200{/if}px; height: {if !empty($filter.preview_height)}{$filter.preview_height|escape}{else}200{/if}px">
                            <div class="s-preview-w grey editable" title="[`Container width`]">[`W:`] <span>{if !empty($filter.preview_width)}{$filter.preview_width|escape}{else}200{/if}</span> <input type="text" name="width" value="{if !empty($filter.preview_width)}{$filter.preview_width|escape}{else}200{/if}" maxlength="3" class="width50px hidden{if empty($filter)} f-save-me{/if}" /> <i class="icon16 disk hidden"></i> px</div>
                            <div class="s-preview-h grey editable" title="[`Container height`]">[`H:`] <span>{if !empty($filter.preview_height)}{$filter.preview_height|escape}{else}200{/if}</span> <input type="text" value="{if !empty($filter.preview_height)}{$filter.preview_height|escape}{else}200{/if}" name="height" maxlength="3" class="width50px hidden{if empty($filter)} f-save-me{/if}" /> <i class="icon16 disk hidden"></i> px</div>
                        </div>
                        <div class="align-center is-loading">[`Wait, please...`] <i class="icon16 loading"></i></div>
                        <a href="#/add/target/" class="s-add-target js-action"><i class="icon16 add"></i> [`Add badge`]</a>
                        <a href="#/import/ExportTemplate/" data-type="import" style="margin-left: 20px;" class="js-action"><i class="icon16 ss excel"></i> [`Import badge`]</a>
                        <div class="autobadge-edit-block margin-block">
                            <div class="autobadge-edit-content block bordered-top">
                                <div class="field">
                                    <div class="name">[`Select shape`]</div>
                                    <div class="value">
                                        <div class="badge-example">
                                            <div id="badge-styles"></div>
                                            <label style="height: 190px">
                                                <input type="radio" name='shape' value="ribbon-1" />
                                                <div class="autobadge-pl ribbon-1"><span class="badge-dashed-line"><span class="badge-text-block"><span>[`Ribbon text`]</span></span></span></div>
                                            </label>
                                            <label style="height: 190px">
                                                <input type="radio" name='shape' value="ribbon-2" />
                                                <div class="autobadge-pl ribbon-2"><span class="badge-dashed-line"><span class="badge-text-block"><span>[`Ribbon text`]</span></span></span></div>
                                            </label>
                                            <label style="height: 190px">
                                                <input type="radio" name='shape' value="ribbon-3" />
                                                <div class="autobadge-pl ribbon-3"><span class="badge-dashed-line"><span class="badge-text-block"><span>[`Ribbon text`]</span></span></span></div>
                                            </label>
                                            <label style="height: 100px">
                                                <input type="radio" name='shape' value="ribbon-4" />
                                                <div class="autobadge-pl ribbon-4"><span class="badge-text-block"><span>[`Text`]</span></span></div>
                                            </label><br>
                                            <label style="height: 100px">
                                                <input type="radio" name='shape' value="ribbon-5" />
                                                <div class="autobadge-pl ribbon-5 with-tail"><span class="badge-dashed-line"><span class="badge-text-block"><span>[`Ribbon text`]</span></span></span><span class="autobadge-pl-tail"></span></div>
                                            </label>
                                            <label style="height: 100px">
                                                <input type="radio" name='shape' value="ribbon-6" />
                                                <div class="autobadge-pl ribbon-6"><span class="badge-text-block"><img src="{$plugin_url}/img/image-icon.png"></span></div>
                                            </label>
                                            <label style="height: 100px">
                                                <input type="radio" name='shape' value="ribbon-7" />
                                                <div class="autobadge-pl ribbon-7"><span class="badge-text-block"><img src="{$plugin_url}/img/html-icon.png"></span></div>
                                            </label>
                                            <div class="clear-both margin-block top default-badge-shape hidden">
                                                <a class="js-action highlighted" href="#/set/defaultSettings/"><i class="icon16 status-blue-tiny"></i> <em>[`Use default settings of badge shape`]</em></a>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="field badge-text">
                                    <div class="name">[`Text/Image`]</div>
                                    <div class="value">
                                        <div class="margin-block bottom badge-line text-item">
                                            <i class="icon16 sort"></i>
                                            <div class="inline-block relative">
                                                <textarea style="padding-right: 30px; height: 30px;" name="value" oninput="$.autobadge_appearance.updateText(this)"></textarea>
                                                <a href="#/show/variables/" data-type='text' title="[`Available variables`]" class="js-action s-show-variable"><i class="icon16 info"></i></a>
                                            </div>
                                            <div class="color-icon" title='[`change color`]' data-color="ffffff"></div>
                                            <input type="hidden" name="color" value="ffffff" oninput="$.autobadge_appearance.updateText(this)" />
                                            <select name="size" class="inline inherit" onchange="$.autobadge_appearance.updateText(this)">
                                                {for $i = 8; $i <= 36; $i++}<option value="{$i}"{if $i == '14'} selected{/if}>{$i}</option>{/for}
                                            </select>
                                            px
                                            <select name="family" class="inline inherit" onchange="$.autobadge_appearance.updateText(this)">
                                                <option value="" selected>[`Font family`]</option>
                                                <option value="Arial,sans-serif">Arial</option>
                                                <option value="'Comic Sans MS',cursive,sans-serif">Comic Sans MS</option>
                                                <option value="'Courier New',Courier,monospace">Courier New</option>
                                                <option value="Georgia,serif">Georgia</option>
                                                <option value="Helvetica,sans-serif">Helvetica</option>
                                                <option value="'Lucida Sans Unicode','Lucida Grande',sans-serif">Lucida Sans</option>
                                                <option value="'Palatino Linotype','Book Antiqua',Palatino,serif">Palantino Linotype</option>
                                                <option value="Tahoma,sans-serif">Tahoma</option>
                                                <option value="'Times New Roman',Times,serif">Times New Romans</option>
                                                <option value="'Trebuchet MS',sans-serif">Trebuchet MS</option>
                                                <option value="Verdana,sans-serif">Verdana</option>
                                                <optgroup label="[`Google fonts`]">
                                                    <option value="'Open Sans',sans-serif">Open Sans</option>
                                                    <option value="'Open Sans Condensed',sans-serif">Open Sans Condensed</option>
                                                    <option value="'Roboto',sans-serif">Roboto</option>
                                                    <option value="'Roboto Condensed',sans-serif">Roboto Condensed</option>
                                                    <option value="'Roboto Slab',serif">Roboto Slab</option>
                                                    <option value="'PT Sans',sans-serif">PT Sans</option>
                                                    <option value="'Lora',serif">Lora</option>
                                                    <option value="'Lobster',cursive">Lobster</option>
                                                    <option value="'Ubuntu',sans-serif">Ubuntu</option>
                                                    <option value="'Noto Sans',sans-serif">Noto Sans</option>
                                                </optgroup>
                                            </select>
                                            <select name="style" class="inline inherit" onchange="$.autobadge_appearance.updateText(this)">
                                                <option value="" selected>[`Font style`]</option>
                                                <option value="normal">[`Normal`]</option>
                                                <option value="bold">[`Bold`]</option>
                                                <option value="italic">[`Italic`]</option>
                                                <option value="bolditalic">[`Bold/Italic`]</option>
                                            </select>
                                            <select name="align" class="inline inherit" onchange="$.autobadge_appearance.updateText(this)">
                                                <option value="" selected>[`Align`]</option>
                                                <option value="left">[`Left`]</option>
                                                <option value="right">[`Right`]</option>
                                                <option value="center">[`Center`]</option>
                                                <option value="justify">[`Justify`]</option>
                                            </select>
                                            <div class="text-margins margin-block top semi">
                                                <div class="inline-block"><label><input type="checkbox" name="shadow" onchange="$.autobadge_appearance.updateText(this)" /> [`Shadow`]</label></div>
                                                <span class="inline-block" style="margin: 0 10px">|</span>
                                                <div class="inline-block">[`Margins`]:</div>
                                                <div class="inline-block align-center"><div class="small">[`Top`]</div><input type="number" class="width70px align-center" name='top' data-parent="margins" oninput="$.autobadge_appearance.updateText(this)" /></div>
                                                <div class="inline-block align-center"><div class="small">[`Right`]</div><input type="number" class="width70px align-center" name='right' data-parent="margins" oninput="$.autobadge_appearance.updateText(this)" /></div>
                                                <span class="inline-block" style="margin: 0 10px">|</span>
                                                <div class="input-group inline-block">
                                                    <span>[`Width`]:</span>
                                                    <input type="number" placeholder="auto" class="width100px align-center" name='width' oninput="$.autobadge_appearance.updateText(this)" /> px
                                                </div>
                                            </div>
                                            <a href='#' onclick='$.autobadge_appearance.removeTextItem(this)' class='js-action inline-block remove-icon' title='[`remove`]'><i class='icon16 no'></i></a>
                                        </div>
                                        <div class="margin-block bottom attachment-container text-item">
                                            <i class="icon16 sort"></i>
                                            <div class="attachment-block">
                                                <div class="inline-block relative">
                                                    <input type="text" style='padding-right: 30px;' oninput="$.autobadge_appearance.updateText(this, true)" name='src' placeholder='[`Specify image URL`]' class='width250px'/>
                                                    <a href="#/show/variables/" data-type='image' title="[`Available images`]" class="js-action s-show-variable"><i class="icon16 info"></i></a>
                                                </div>
                                                [`or`] <input type="file" name="image" class="fileupload-attachment">
                                                <div class="progressfield-block hidden block"></div>
                                            </div>
                                            <div class="margin-block top">
                                                <div class="inline-block">[`Margins`]:</div>
                                                <div class="inline-block align-center">
                                                    <ul class="tabs small"><li class="selected"><a href="#/change/imageMarginsTab/" class="js-action" data-tab="top">[`Top`]</a></li><li class="no-tab"><a href="#/change/imageMarginsTab/" class="js-action" data-tab="bottom">[`Bottom`]</a></li></ul>
                                                    <input type="number" class="width100px align-center" name='top' value='0' oninput="$.autobadge_appearance.updateText(this, true)" />
                                                </div>
                                                <div class="inline-block align-center">
                                                    <ul class="tabs small"><li class="selected"><a href="#/change/imageMarginsTab/" class="js-action" data-tab="right">[`Right`]</a></li><li class="no-tab"><a href="#/change/imageMarginsTab/" class="js-action" data-tab="left">[`Left`]</a></li></ul>
                                                    <input type="number" class="width100px align-center" name='right' value='0' oninput="$.autobadge_appearance.updateText(this, true)" />
                                                </div>
                                                <span class="inline-block" style="margin: 0 10px">|</span>
                                                <div class="input-group inline-block">
                                                    <span>[`Width`]:</span>
                                                    <input type="number" placeholder="auto" oninput="$.autobadge_appearance.updateText(this, true)" class="width100px align-center" name='width' /> px
                                                </div>
                                                <div class="input-group inline-block">
                                                    <span>[`Height`]:</span>
                                                    <input type="number" placeholder="auto" oninput="$.autobadge_appearance.updateText(this, true)" class="width100px align-center" name='height' /> px
                                                </div>
                                            </div>
                                            <div class="margin-block top l-h"><i class="icon16 exclamation"></i> [`Attention! Image dimensions will be changed with the help of CSS. Filesize will be the same. Don't use large images.`]</div>
                                            <a href='#' onclick='$.autobadge_appearance.removeTextItem(this)' class='js-action inline-block remove-icon' title='[`remove`]'><i class='icon16 no'></i></a>
                                        </div>
                                        <div class="margin-block bottom custom-container text-item">
                                            <div class="inline-block relative">
                                                <textarea style="width: 100%; height: 50px; padding-right: 30px;" name="content" oninput="$.autobadge_appearance.updateText(this)"></textarea>
                                                <a href="#/show/variables/" data-type='text' title="[`Available variables`]" class="js-action s-show-variable"><i class="icon16 info"></i></a>
                                            </div>
                                            <div class="margin-block top l-h"><i class="icon16 exclamation"></i> [`Attention! Be careful with HTML-code. Any syntax errors can cause problems in your theme design.`]</div>
                                        </div>
                                        <div class="text-buttons margin-block top">
                                            <div class="inline-block s-multiline"><a href="#/add/textItemLine/" data-type="text" class="js-action" title="[`add text line`]"><i class="icon10 add"></i> [`add text line`]</a></div>
                                            <div class="inline-block" style='margin-left: 10px'><a href="#/add/textItemLine/" data-type="image" class="js-action" title="[`add image`]"><i class="icon16 image"></i> [`add image`]</a></div>
                                        </div>
                                    </div>
                                </div>
                                <div class="field">
                                    {include file='./../../include.appearance.html'}
                                </div>
                            </div>
                            <div class="margin-block top s-save-badge align-center">
                                <a href="#/save/Template/" class="button blue js-action">[`Save template`]</a>
                                <a href="#/remove/Template/" class="button red js-action">[`Remove template`]</a>
                                <a href="#/import/ExportTemplate/" data-type="export" style="margin-left: 20px;" class="js-action"><i class="icon16 ss excel"></i> [`Export`]</a>
                            </div>
                        </div>
                    </div>
                </div>
                {* Conditions *}
                {$conditions = [
                    [
                        'name' => "[`Product`]",
                        'fields' => ['cat' => "[`Category`]", 'cat_all' => "[`Category and subcategories`]",
                        'set' => "[`Product set`]", 'type' => "[`Product type`]", 'product' => "[`Product`]", 'feature' => "[`Product features`]",
                        'params' => "[`Product params`]"]
                    ],
                    [
                        'name' => "[`Product properties`]",
                        'fields' => ['product_name' => "[`Name`]", 'product_sku' => "[`SKU code`]", 'product_sku_name' => "[`SKU name`]",
                        'product_summary' => "[`Summary`]", 'product_mt' => "[`META title`]", 'product_mk' => "[`META keywords`]",
                        'product_md' => "[`META description`]", 'product_description' => "[`Description`]", 'product_create' => "[`Create datetime`]",
                        'product_age' => "[`Product age`]", 'product_edit' => "[`Edit datetime`]", 'product_video' => "[`Has video`]",
                        'product_image' => "[`Has image`]", 'product_rating' => "[`Rating`]", 'product_rating_count' => "[`Rating count`]",
                        'product_price' => "[`Price`]", 'product_margin' => "[`Price`] - [`Purchase price`]",
                        'product_margin_comp' => "[`Compare price`] - [`Price`]", 'product_compare_price' => "[`Compare price`]",
                        'product_purchase_price' => "[`Purchase price`]", 'product_min_price' => "[`Minimal price`]",
                        'product_max_price' => "[`Maximum price`]", 'product_stock' => "[`Stock count`]",
                        'product_total_sales' => "[`Total sales for period..`]", 'product_number_sales' => "[`Total number of sales for period..`]",
                        'product_services' => "[`Services`]", 'product_tags' => "[`Tags`]", 'product_badge_type' => "[`Badge type`]"]
                    ],
                    [
                        'name' => "[`Cart`]",
                        'fields' => ['num_total' => "[`Total quantity of all products`]", 'num' => "[`Quantity of products`]", 'num_prod' => "[`Quantity of product`]",
                        'num_cat' => "[`Quantity of product from category`]", 'num_cat_all' => "[`Quantity of product from category and subcategories`]",
                        'num_set' => "[`Quantity of product from set`]", 'num_type' => "[`Quantity of product from type`]",
                        'num_all_cat' => "[`Quantity of all products from category`]",
                        'num_all_cat_all' => "[`Quantity of all products from category and subcategories`]",
                        'num_all_set' => "[`Quantity of all products from set`]", 'num_all_type' => "[`Quantity of all products from type`]",
                        'num_feat' => "[`Quantity of products with features`]", 'num_items' => "[`Quantity of unique items`]",
                        'total' => "[`Order price without discount`]",
                        'sum' => "[`Total price of all products`]", 'sum_cat' => "[`Total price of products from category`]",
                        'sum_cat_all' => "[`Total price of products from category and subcategories`]",
                        'sum_feat' => "[`Total price of all products with features`]", 'total_feat' => "[`Total sum of features values`]",
                        'prod_each_price' => "[`Price of each product`]", 'services' => "[`Services`]"]
                    ],
                    [
                        'name' => "[`User`]",
                        'fields' => ['ucat' => "[`User category`]", 'user' => "[`User`]", 'user_date' => "[`Create datetime`]"]
                    ],
                    [
                        'name' => "[`Completed user orders`]",
                        'fields' => ['all_orders' => "[`Total sum of all orders`]", 'order_int' => "[`Sum of orders for period..`]",
                        'count_orders' => "[`Quantity of all orders`]", 'order_count_int' => "[`Quantity of orders for period..`]", 'order_prod' => "[`Orders have product`]",
                        'order_prod_int' => "[`Orders have product for period..`]", 'order_prod_cat' => "[`Orders have product from category`]",
                        'order_prod_cat_all' => "[`Orders have product from category and subcategories`]", 'order_prod_cat_int' => "[`Orders have product from category for period..`]",
                        'order_prod_cat_all_int' => "[`Orders have product from category and subcategories for period..`]"]
                    ],
                    [
                        'name' => "[`Date and time`]",
                        'fields' => ['date' => "[`Date`]", 'week' => "[`Day of week`]", 'time' => "[`Time`]"]
                    ],
                    [
                        'name' => "[`Variables`]",
                        'fields' => ['cookie' => "[`Cookie`]", 'session' => "[`Session`]", 'get' => '$_GET',
                        'post' => '$_POST', 'server' => '$_SERVER']
                    ],
                    [
                    'name' => "[`Storefront`]",
                    'fields' => ['storefront' => "[`Storefront`]", 'payment' => "[`Payment`]", 'shipping' => "[`Shipping`]",
                    'mobile' => "[`Mobile version`]", 'theme' => "[`Theme design`]", 'product_page' => "[`Product page`]"]
                    ]
                ]}
                <select id="condition-template" class="condition-template" data-placeholder="[`Select condition`]" style="display: none; width: 350px;">
                    <option value=""></option>
                    <option value="add">[`Add group of conditions`]</option>
                    {foreach $conditions as $cond}
                    <optgroup label="{$cond.name}">
                        {foreach $cond.fields as $c_id => $c}
                            <option value="{$c_id}">{$c}</option>
                        {/foreach}
                    </optgroup>
                    {/foreach}
                </select>
                <div class="target-row margin-block bottom" id="target-template" style="display: none;">
                    <div class="condition-text"><i class="icon16 sort"></i></div>
                    <div class="condition-text">
                        <select name="data[target]" style="width: 350px;" class="target-chosen" data-placeholder="[`Select badge`]">
                            <option value=""></option>
                            <option class="s-create" value="create">[`Create new badge`]</option>
                            {if !empty($target)}
                                {foreach $target as $targ_id => $targ}
                                    <optgroup label="{$targ.name|escape}" class="option-{$targ_id}"{if empty($targ.fields)} style="display: none"{/if}>
                                        {foreach $targ.fields as $t_id => $t}
                                            <option class="{$t_id}" value="{$t_id}">{$t}</option>
                                        {/foreach}
                                    </optgroup>
                                {/foreach}
                            {/if}
                        </select>
                        <div class="target-block hidden">
                            <!-- Autogenerated content -->
                        </div>
                        <a href="#/edit/target/" class='js-action inline-link s-edit-target' style='display: none;'><i class="icon16 edit"></i> <b>[`edit badge`]</b></a>
                    </div>
                </div>
            </div>
        </div>
        <div id="fixed-save-panel">
            <div class="block bordered-top">
                <input class="button green" type="submit" disabled value="[`Save filter`]">
            </div>
        </div>
    </div>
    {if !empty($filter)}
        <input type="hidden" name='id' value='{$filter.id}' class="f-save-me" />
    {/if}

    <div id="tooltip-text" class="tooltip">
        <div class='avail-variables'>
            <h2>[`Available variables`]</h2>
            <p>[`Copy and paste variables into the text field. Also you can use Smarty.`]</p>
            <ul class="menu-v">
                <li><span>&#123;$product.name&#125;</span> - [`product name`]</li>
                <li><span>&#123;$product.sku_code&#125;</span> - [`SKU code`]</li>
                <li><span>&#123;$product.sku_name&#125;</span> - [`SKU name`]</li>
                <li><span>&#123;$product.summary&#125;</span> - [`Product summary`]</li>
                    <li><span>&#123;$product.create_datetime&#125;</span> - [`Product create datetime`]</li>
                <li><span>&#123;$product.edit_datetime&#125;</span> - [`Product edit datetime`]</li>
                <li><span>&#123;$product.rating&#125;</span> - [`Product rating`]</li>
                <li><span>&#123;$product.rating_count&#125;</span> - [`Product rating count`]</li>
                <li><span>&#123;$product.price&#125;</span> - [`Product price`]</li>
                <li><span>&#123;$product.compare_price&#125;</span> - [`Product compare price`]</li>
                <li><span>&#123;$product.purchase_price&#125;</span> - [`Product purchase price`]</li>
                <li><span>&#123;shop_currency($product.price, true)&#125;</span> - [`Product price`] [`with currency`]</li>
                <li><span>&#123;shop_currency($product.compare_price, true)&#125;</span> - [`Product compare price`] [`with currency`]</li>
                <li><span>&#123;shop_currency($product.purchase_price, true)&#125;</span> - [`Product purchase price`] [`with currency`]</li>
                <li><span>&#123;shop_currency_html($product.price, true)&#125;</span> - [`Product price`] [`with ruble sign`]</li>
                <li><span>&#123;shop_currency_html($product.compare_price, true)&#125;</span> - [`Product compare price`] [`with ruble sign`]</li>
                <li><span>&#123;shop_currency_html($product.purchase_price, true)&#125;</span> - [`Product purchase price`] [`with ruble sign`]</li>
                <li><span>&#123;$product.margin&#125;</span> - [`Product price`] - [`Product purchase price`]</li>
                <li><span>&#123;$product.margin_comp&#125;</span> - [`Product compare price`] - [`Product price`]</li>
                <li><span>&#123;$product.count&#125;</span> - [`Stock count`]</li>
                <li><span>&#123;$product.sku_count&#125;</span> - [`Number of skus`]</li>
                <li><span>&#123;$smarty.now|wa_datetime:"humandate"&#125;</span> - [`Datetime. <a href="https://developers.webasyst.com/cookbook/basics/functions/#function-wa_date" target="_blank">Read more</a>`]</li>
                <li><span>&#123;$product.discount_percentage&#125;</span> - [`Discount percentage.`]</li>
                <li><span>&#123;counter date="26.09.2017"&#125;</span> - [`Countdown. <a href="https://www.webasyst.com/store/plugin/shop/autobadge/text/" target="_blank">Read more</a>`]</li>
                <li><hr><p>[`You can use optional set of custom <em>key=value</em> parameters which can be used as <em>&#123;$product.params.key&#125;</em>`]</p></li>
            </ul>
        </div>
        <div class='avail-images'>
            <h2>[`Available images`]</h2>
            <p>[`This is your uploaded images. You can select one.`]<br>[`Also you can manage this images in`]{if $site_access} <a href='{$wa_backend_url}site/#/files/plugins/autobadge/' title='[`Manage images`]' target='_blank'>[`Site - File manager`]<i class="icon16 new-window"></i> </a>{else} [`Site - File manager`]{/if}</p>
            {if $uploaded_images}
            <ul class="menu-v">
                {foreach $uploaded_images as $n}
                    <li><a href='#/select/uploadedImage/' data-link="{$image_url}{$n}" title='[`Select image`]' class="js-action"><span>{$n|truncate:70}</span></a></li>
                {/foreach}
            </ul>
            {/if}
        </div>
        <a href="javascript:void(0)" title="[`close`]" onclick="$(this).closest('.tooltip').remove();" class="dialog-close">[`close`]</a>
    </div>
</form>
{$currency = $wa->shop->currency(true)}
<script>
    $(function() {
        $.autobadge.locale = "{$wa->locale()}";
        $.autobadge.pluginUrl = "{$plugin_url}";
        {foreach $default_ribbons as $r_id => $r}
            $.autobadge_appearance.ribbons['default_{$r_id}'] = {json_encode($r)};
        {/foreach}
        {if !empty($templates)}
           $.autobadge_appearance.templates = {json_encode($templates)};
        {/if}

        $.autobadge.initFilterPage({if !empty($filter)}{$filter.id}{/if});
        $.autobadge_conditions.init({
            conditions: {if !empty($filter.conditions)}{$filter.conditions}{else}""{/if},
            target: {if !empty($filter.target)}{$filter.target}{else}""{/if},
            currency: {json_encode($currency.sign)}
       });
    });
</script>